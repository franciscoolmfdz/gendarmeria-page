import{r as x,u as w,g as d,h as M,y as E,o as n,c as p,b as C,w as R,v as L,a as b,f as F,z as N,m as D,F as $,A as q,e as V,l as U,t as j}from"./index-dd4685c7.js";import{_ as y}from"./CButton-4bbc2b87.js";const z={class:"c-filterbar"},O={class:"selected-options"},P={key:0,class:"selected-centros"},T={class:"select-centro-content"},X={class:"c-option-volver"},J={__name:"CFilterbar",props:{baseFilter:{type:[Object,Number,String],required:!0},multipleDisabled:{type:Boolean,default:!0},monthDisabled:{type:Boolean,default:!1}},emits:["executeAction","executeRemove","executeMount"],setup(_,{emit:v}){const o=_,m=x({disabledCentros:!1}),a=w(),A=d("Buscar"),f=d(!1),h=d(a.penitenciaria),r=x([]),c=d(a.periodo),B=l=>{const e=r.filter(s=>s.id===l);i.value.push(e[0]),i.value.sort((s,u)=>s.id<u.id);const t=r.filter(s=>s.id!==l);r.splice(0,r.length),t.map(s=>r.push(s)),v("executeRemove",l)},I=()=>{o.baseFilter===1?V.push("/vidaInternosMain"):o.baseFilter===2&&V.push("/vidaFuncionariosMain")},S=async()=>{const l=i.value.filter(s=>s.id===h.value)[0];!o.multipleDisabled&&l&&(r.push(l),i.value=i.value.filter(s=>s.id!==l.id),a.removeCarcelesSelected());const e=c.value.split("-"),t={year:e[0],month:e[1],categoryId:o.baseFilter};await g(t),a.changeCriteria({periodo:c.value,penitenciaria:l??i[0]}),v("executeAction")},i=d(a.listadoCarceles),g=async l=>{f.value=!0;const e=await U(l);if(f.value=!1,e&&(e!=null&&e.period)&&(e!=null&&e.id)){const{period:t=null,id:s=null}=e;a.mountBaseHistory({period:t,id:s}),c.value=t}else a.cleanHistory()},k=()=>{const l=a.user.restrictions.find(t=>t.typeId===2),e=a.user.restrictions.find(t=>t.typeId===3);if(!l&&!e)return{};if(l)return m.disabledCentros=!1,{regionId:parseInt(l.restriction)};if(e)return m.disabledCentros=!0,{carcelIds:parseInt(e.restriction)}};return M(async()=>{var t;o.multipleDisabled||(A.value="Agregar a la bÃºsqueda");const l={lastPeriod:!0,categoryId:o.baseFilter},e=k();if(await g(l),!i.value||i.value.length===0){const s=await E(e);a.mountListCarceles(s),(t=a.penitenciaria)!=null&&t.id&&!o.multipleDisabled?(r.splice(0,r.length),a.carcelesSelected.map(u=>r.push(u)),i.value=s.filter(u=>u.id!==a.penitenciaria.id),a.removeCarcelesSelected()):i.value=s}o.multipleDisabled?v("executeAction"):v("executeMount")}),(l,e)=>(n(),p("div",z,[C("div",O,[_.monthDisabled?b("",!0):R((n(),p("input",{key:0,class:"periodo-item",type:"month","onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t)},null,512)),[[L,c.value]]),m.disabledCentros?b("",!0):(n(),F(N,{key:1,class:"c-select-item",options:i.value,modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t)},null,8,["options","modelValue"])),D(y,{class:"c-filterbar-search",title:"",onExecuteAction:S,disabled:f.value},null,8,["disabled"])]),_.multipleDisabled?b("",!0):(n(),p("div",P,[(n(!0),p($,null,q(r,t=>(n(),p("div",T,[C("span",null,j(t.description),1),m.disabledCentros?b("",!0):(n(),F(y,{key:0,class:"deleted-centro",title:"X",onExecuteAction:s=>B(t.id)},null,8,["onExecuteAction"]))]))),256))])),C("div",X,[D(y,{class:"btn-volver-filter",title:"Volver",onExecuteAction:I,disabled:f.value},null,8,["disabled"])])]))}};export{J as _};
