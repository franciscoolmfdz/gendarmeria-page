import{g as s,h as D,o as g,f as S,j as $,_ as B,J as k,l as E,C as x,q as A,m as n,b as u,x as j,c as M,a as N,e as P}from"./index-caf32ba9.js";import{_ as F}from"./subSideNav-a58b3954.js";import{_ as H}from"./CHeaderBar-d352756e.js";import{_ as m}from"./CButton-98714c16.js";import{_ as q}from"./CTable-0b9142cc.js";import{s as J}from"./filterSituacion-e46a409d.js";import"./CChartDonutSection-6897dea7.js";const U={class:"selected-options"},z={key:0,class:"c-option-volver"},G={class:"table-section-principal"},K={class:"content__section"},c=3,w=29,ae={__name:"licencias",setup(O){const i=J(),o=s({id:15,description:"Región Metropolitana de Santiago"}),l=s(),p=s(0),v=s(0),r=s(),f=s("Estado situación carcelaria / Licencias del personal"),L=s([{rowReference:"carcel",description:"Establecimiento penal"},{rowReference:"tieneLicencia",description:"Licencia vigente"},{rowReference:"noLicenciaVigente",description:"Sin licencia vigente"},{rowReference:"licenseTotal",description:"Totales"},{rowReference:"porcentajeLicencia",description:"% Licencias"}]),d=s([]),b=()=>{P.push("/situacionCarcelaria")},V=e=>e?`${Math.round(e*100)/100} %`:"0 %",_=async()=>{try{if(o.value){const e=await y(),a=await k(e);d.value=a.map(t=>{const C=i.listadoCarceles.find(T=>T.id==t.carcelId);t.carcel=C.description,t.tieneLicencia=t.licenseActiveTotal,t.noLicenciaVigente=t.licenseDisabledTotal,t.licenseTotal=t.licenseActiveTotal+t.licenseDisabledTotal;const I=t.tieneLicencia/t.licenseTotal*100;return t.porcentajeLicencia=V(I),t})}else d.value=[]}catch(e){console.log(e)}},y=async()=>{var a;let e={categoryId:c,subCategoryId:w,lastPeriod:!0};return r.value||(r.value=await E(e)),e={categoryId:c,subCategoryId:w,historyId:r.value.id,embedLicenses:!0},p.value?e.regionId=p.value:(a=i==null?void 0:i.regionSelected)!=null&&a.id&&(e.regionId=i.regionSelected.id),v.value&&(e.carcelId=v.value),await R(),e},R=async()=>{if(!i.listadoCarceles.length){const e={regionId:i.regionSelected.id};let a=await x(e);i.setCarcelesList(a)}},h=async e=>{if(!i.listadoRegiones.length>0){let a=await A();l.value=a,i.setRegionesList(a)}else l.value=i.listadoRegiones};return D(async()=>{o.value=i.regionSelected,await h(),await _()}),(e,a)=>(g(),S(B,{class:"contenido-licencia"},{default:$(()=>[n(H,{title:f.value,"section-value":c},null,8,["title"]),u("div",U,[n(j,{class:"select-region",options:l.value,modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=t=>o.value=t)},null,8,["options","modelValue"]),n(m,{class:"btn-search",title:"",onExecuteAction:_})]),!e.activeSpin&&e.topPosition!==0?(g(),M("div",z,[n(m,{class:"btn-volver",title:"Volver",onExecuteAction:b,disabled:e.blockButton},null,8,["disabled"])])):N("",!0),u("div",G,[n(F,{class:"subsection-licencias",title:f.value,"section-value":c,pointValue:e.pointCalculated,pointTitle:"Dotación efectiva del personal",pointSubtitle:""},null,8,["title","pointValue"]),u("div",K,[n(q,{columns:L.value,rows:d.value},null,8,["columns","rows"])])])]),_:1}))}};export{ae as default};
