import{g as i,h as J,o as L,f as K,j as O,_ as Q,l as _,q as W,b as g,m as c,n as X,x as Y,c as Z,a as ee,e as te,C as ae}from"./index-67eed0ab.js";import{_ as oe}from"./subSideNav-5b9a9492.js";import{_ as se}from"./CHeaderBar-d68a262d.js";import{_ as $}from"./CButton-9e3ba2d4.js";import{_ as ie}from"./CTable-0226543d.js";import{s as ne}from"./filterSituacion-32c57da3.js";import"./CChartDonutSection-5dbbc148.js";const re={class:"content-poblacion-header"},ce={class:"selected-options"},le={key:0,class:"c-option-volver"},de={class:"table-section-principal"},ue={class:"content__section"},u=3,B=30,E=29,je={__name:"dotacionPoblacion",setup(pe){const C=i("Estado situación carcelaria / Dotación vs población"),s=ne(),k=i(null),b=i({id:15,description:"Región Metropolitana de Santiago"}),j=i([]),n=i(0),H=i(0),I=i(),y=i(),v=i(!1),A=i([{description:"Centro penitenciario",colspan:1},{description:"Dotación total",colspan:1},{description:"Total PPL. 24h",colspan:3},{description:"Capacidad según diseño (Incluye 24 hrs y juveniles)",colspan:3},{description:"En % relación dotación vs total ppl",colspan:2}]),N=i([{rowReference:"establecimiento",description:""},{rowReference:"dotacionTotal",description:""},{rowReference:"totalPplHombre",description:"Hombre"},{rowReference:"totalPplMujer",description:"Mujer"},{rowReference:"totalPplTotal",description:"Total"},{rowReference:"capacidadHombre",description:"Hombre"},{rowReference:"capacidadMujer",description:"Mujer"},{rowReference:"capacidadTotal",description:"Total"},{rowReference:"dotacionRotacion",description:"(cantidad de internos por funcionario)"},{rowReference:"porcRotacionDotacion",description:"En % relación dotación vs total ppl"}]),w=i([]),l=e=>e<85?"class-verde":e>85&&e<99?"class-ambar":"class-rojo",F=()=>{te.push("/situacionCarcelaria")},d=e=>e?`${Math.round(e*100)/100} %`:"0 %",q=(e,t)=>{const a=s.listadoCarceles.find(o=>o.id===e.carcelId);if(a&&(a!=null&&a.id)){let o=0;t.filter(M=>M.carcelId===a.id).map(M=>o+=M.licenseActiveTotal+M.licenseDisabledTotal);const r=e.imputadoHombre+e.condenadoHombre+e.procesadoHombre+e.detenidoHombre,f=e.imputadoMujer+e.condenadoMujer+e.procesadoMujer+e.detenidoMujer,p=r+f,R=e.imputadoHombre+e.imputadoMujer,m=e.pplMaxMujer+e.pplMaxHombre,T=r&&e.pplMaxHombre?d(r*100/e.pplMaxHombre):0,x=f&&e.pplMaxMujer?d(f*100/e.pplMaxMujer):0,P=p&&m?d(p*100/m):0,D=e.imputadoHombre&&e.pplMaxHombre?d(e.imputadoHombre*100/e.pplMaxHombre):0,S=e.imputadoMujer&&e.pplMaxMujer?d(e.imputadoMujer*100/e.pplMaxMujer):0,V=R&&m?d(R*100/m):0;return{dotacionTotal:o,carcelId:a.id,establecimiento:a.description,imputadoHombre:e.imputadoHombre,imputadoMujer:e.imputadoMujer,imputadoTotal:e.imputadoHombre+e.imputadoMujer,totalPplHombre:r,totalPplMujer:f,totalPplTotal:p,capacidadHombre:e.pplMaxHombre,capacidadMujer:e.pplMaxMujer,capacidadTotal:m,usoCapacidadHombre:{data:T+"%",class:l(T)},usoCapacidadMujer:{data:x+"%",class:l(x)},usoCapacidadTotal:{data:P+"%",class:l(P)},usoImputadoHombre:{data:D+"%",class:l(D)},usoImputadoMujer:{data:S+"%",class:l(S)},usoImputadoTotal:{data:V+"%",class:l(V)},dotacionRotacion:Math.round(p/o),porcRotacionDotacion:Math.round(o/p*100)}}},U=async()=>{var a,o,r;let e={categoryId:u,historySubCategoryId:B,lastPeriod:!0};I.value||(I.value=await _(e));let t={categoryId:u,historySubCategoryId:E,lastPeriod:!0};return y.value||(y.value=await _(t)),e={categoryId:u,historySubCategoryId:B,historyId:I.value.id,embedPopulation:!0},t={categoryId:u,historySubCategoryId:E,historyId:y.value.id,embedLicenses:!0},n.value?(e.regionId=(a=n.value)!=null&&a.id?n.value.id:n.value,t.regionId=(o=n.value)!=null&&o.id?n.value.id:n.value):(r=s==null?void 0:s.regionSelected)!=null&&r.id&&(e.regionId=s.regionSelected.id,t.regionId=s.regionSelected.id),H.value&&(e.carcelId=H.value,t.carcelId=H.value),await z(),{filtersPoblacion:e,filtersLicencias:t}},z=async()=>{if(!s.listadoCarceles.length){let e=await ae();s.setCarcelesList(e)}},h=async()=>{try{if(n){const e=await U();let t=await _(e.filtersPoblacion),a=await _(e.filtersLicencias);w.value=t.items.map(o=>q(o,(a==null?void 0:a.items)??[])).filter(o=>o)}}catch(e){console.log(e)}},G=async e=>{if(!s.listadoRegiones.length>0){let t=await W();j.value=t,s.setRegionesList(t)}else j.value=s.listadoRegiones};return J(async()=>{v.value=!0,b.value=s.regionSelected,await G(),await h(),v.value=!1}),(e,t)=>(L(),K(Q,{class:"contenido-dotacion-poblacion"},{default:O(()=>[g("div",re,[c(se,{title:C.value,"section-value":u},null,8,["title"]),c(X,{"active-spin":v.value},null,8,["active-spin"]),g("div",ce,[c(Y,{class:"select-region",options:j.value,modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a)},null,8,["options","modelValue"]),c($,{class:"btn-search",title:"",onExecuteAction:h})]),!v.value&&e.topPosition!==0?(L(),Z("div",le,[c($,{class:"btn-volver",title:"Volver",onExecuteAction:F,disabled:e.blockButton},null,8,["disabled"])])):ee("",!0)]),g("div",de,[c(oe,{class:"subsection-poblacion",title:C.value,"section-value":u,pointValue:k.value,pointTitle:"Dotación vs población",pointSubtitle:""},null,8,["title","pointValue"]),g("div",ue,[c(ie,{"parent-columns":A.value,columns:N.value,rows:w.value},null,8,["parent-columns","columns","rows"])])])]),_:1}))}};export{je as default};
