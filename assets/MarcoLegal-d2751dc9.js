import{g as n,u as ee,r as ae,h as te,i as oe,o as d,f as v,j as l,_ as ne,m as o,n as le,b as r,c as M,I as U,a as N,w as D,v as h,K as $}from"./index-26d193c9.js";import{s as se,f as u,D as H,_ as R,a as m,b as q}from"./files-cc4d35c2.js";import{_ as re}from"./CHeaderBar-01ab725c.js";import{_ as O}from"./CFileManagement-65647e1f.js";import{_ as T}from"./CTable-a3b84a25.js";const ie={class:"section-table-articulo"},ce=r("i",{class:"large material-icons"},"arrow_upward",-1),ue={class:"content-document__section"},de={class:"section-table-norma"},me=r("i",{class:"large material-icons"},"arrow_upward",-1),_e={class:"content-document__section"},L=8,J=9,K=1,be={__name:"MarcoLegal",setup(pe){const j=n("Marco legal"),C=n(),A=n(),i=n(!1),_=n(null),f=n(null),g=n(null),y=n(null),w=n(null),b=n(null),z=ee(),p=ae({disabledEdit:!1}),I=n([{rowReference:"createdBy",description:"Autor"},{rowReference:"name",description:"Nombre de archivo"},{rowReference:"fechaCreacion",description:"Año"},{rowReference:"resumen",description:"Contenido "}]),V=se(),k=n(V.documentData),S=n(V.documentDataNorma),B=()=>p.disabledEdit?[{name:"descargar",iconName:"pageview"}]:[{name:"descargar",iconName:"pageview"}],G=()=>{z.user.restrictions.filter(e=>e.id===1).length>0?p.disabledEdit=!1:p.disabledEdit=!0},E=()=>{},P=async()=>{console.log(_.value);const a=new FormData;a.append("archivo",_.value),a.append("categoryId",L),a.append("usrId",K),a.append("extendedData",JSON.stringify({createdBy:g.value,resumen:w.value}));const e={ignoreHeader:!0};await u.postFiles(a,e),await F()},Q=async()=>{const a=new FormData;a.append("archivo",f.value),a.append("categoryId",J),a.append("usrId",K),a.append("extendedData",JSON.stringify({createdBy:y.value,resumen:b.value}));const e={ignoreHeader:!0};await u.postFiles(a,e),await x()},W=()=>{C.value.open()},X=()=>{A.value.open()},Y=async a=>{const e={id:a.request.id};if(a.actionName==="descargar"){const s={id:a.request.id},t={download:!0},c=await u.getFiles(s,t);window.open(c,"_blank"),await mountData()}else a.actionName==="borrar"&&(await u.deleteFiles(e),await F())},Z=async a=>{const e={id:a.request.id};if(a.actionName==="descargar"){const s={id:a.request.id},t={download:!0},c=await u.getFiles(s,t);window.open(c,"_blank"),await x()}else a.actionName==="borrar"&&(await u.deleteFiles(e),await x())},x=async()=>{i.value=!0,f.value=null,y.value=null,b.value=null;let a=await u.getFiles({categoryId:J});a=a.map(e=>{var t,c;let s=H.fromISO(e.createdAt).toFormat("dd/MM/yyyy HH:mm");return e.fechaCreacion=s,e.createdBy=(t=e.extendedData)==null?void 0:t.createdBy,e.resumen=(c=e.extendedData)==null?void 0:c.resumen,e.actions=B(),e}),S.value=a,i.value=!1},F=async()=>{i.value=!0,_.value=null,g.value=null,w.value=null;let a=await u.getFiles({categoryId:L});a=a.map(e=>{var t,c;let s=H.fromISO(e.createdAt).toFormat("dd/MM/yyyy HH:mm");return e.fechaCreacion=s,e.createdBy=(t=e.extendedData)==null?void 0:t.createdBy,e.resumen=(c=e.extendedData)==null?void 0:c.resumen,e.actions=B(),e}),k.value=a,i.value=!1};return te(async()=>{G(),await F(),await x()}),(a,e)=>{const s=oe("router-view");return d(),v(ne,{class:"table-marco-legal"},{default:l(()=>[o(re,{title:j.value},null,8,["title"]),o(le,{"active-spin":i.value},null,8,["active-spin"]),r("div",ie,[!p.disabledEdit&&!i.value?(d(),M("button",{key:0,onClick:W,class:"btn agregar__archivo-articulo"},[U("Agregar articulo "),ce])):N("",!0),o(q,{ref_key:"modalForm",ref:C,title:"Subir documento",onClose:E,onSubmit:P},{default:l(()=>[o(R,null,{default:l(()=>[o(m,{title:"Archivo"},{default:l(()=>[o(O,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),o(m,{title:"Autor"},{default:l(()=>[D(r("input",{class:"search__content--text","onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),placeholder:"Ingresar autor",type:"text"},null,512),[[h,g.value]])]),_:1}),o(m,{title:"Contenido"},{default:l(()=>[D(r("textarea",{class:"search__content--text","onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),placeholder:"Ingresar resumen del contenido",type:"text",maxlength:"100"},`\r
        `,512),[[h,w.value]])]),_:1})]),_:1},512),r("div",ue,[o(s,null,{default:l(({Component:t})=>[(d(),v($,null,[i.value?N("",!0):(d(),v(T,{key:0,columns:I.value,rows:k.value,"actions-active":"",onExecuteActionlist:Y},null,8,["columns","rows"]))],1024))]),_:1})])]),r("div",de,[!p.disabledEdit&&!i.value?(d(),M("button",{key:0,onClick:X,class:"btn agregar__archivo-articulo-norma"},[U("Agregar norma "),me])):N("",!0),o(q,{ref_key:"modalFormNorma",ref:A,title:"Subir documento",onClose:E,onSubmit:Q},{default:l(()=>[o(R,null,{default:l(()=>[o(m,{title:"Archivo"},{default:l(()=>[o(O,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),o(m,{title:"Autor"},{default:l(()=>[D(r("input",{class:"search__content--text","onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t),placeholder:"Ingresar autor",type:"text"},null,512),[[h,y.value]])]),_:1}),o(m,{title:"Contenido"},{default:l(()=>[D(r("textarea",{class:"search__content--text","onUpdate:modelValue":e[5]||(e[5]=t=>b.value=t),placeholder:"Ingresar resumen del contenido",type:"text",maxlength:"100"},`\r
            `,512),[[h,b.value]])]),_:1})]),_:1},512),r("div",_e,[o(s,null,{default:l(({Component:t})=>[(d(),v($,null,[i.value?N("",!0):(d(),v(T,{key:0,columns:I.value,rows:S.value,"actions-active":"",onExecuteActionlist:Z},null,8,["columns","rows"]))],1024))]),_:1})])])]),_:1})}}};export{be as default};
