import{r as c,d as S,g as B,o as u,c as d,a as h,j as A,v as V,f as x,b,F as k,k as w,t as E}from"./index-c0caa7b8.js";import{u as L,a as M,b as y}from"./CCard-d62b6639.js";import{b as N,a as R}from"./dimensionHistory-b6bfb333.js";const $={class:"c-filterbar"},j={class:"selected-options"},q={key:0,class:"selected-centros"},P={__name:"CFilterbar",props:{baseFilter:{type:[Object,Number,String],required:!0},multipleDisabled:{type:Boolean,default:!0},monthDisabled:{type:Boolean,default:!1}},emits:["executeAction","executeRemove","executeMount"],setup(m,{emit:p}){const n=m,l=L(),_=c("Buscar"),v=c(!1),f=c(l.penitenciaria),i=S([]),r=c(l.periodo),C=s=>{const e=i.filter(t=>t.id===s);o.value.push(e[0]),o.value.sort((t,F)=>t.id<F.id);const a=i.filter(t=>t.id!==s);i.splice(0,i.length),a.map(t=>i.push(t)),p("executeRemove",s)},D=async()=>{const s=o.value.filter(t=>t.id===f.value)[0];n.multipleDisabled||(i.push(s),o.value=o.value.filter(t=>t.id!==s.id),l.removeCarcelesSelected());const e=r.value.split("-"),a={year:e[0],month:e[1],categoryId:n.baseFilter};await g(a),l.changeCriteria({periodo:r.value,penitenciaria:s}),p("executeAction")},o=c(l.listadoCarceles),g=async s=>{v.value=!0;const e=await R(s);if(v.value=!1,e&&(e!=null&&e.period)&&(e!=null&&e.id)){const{period:a=null,id:t=null}=e;l.mountBaseHistory({period:a,id:t}),r.value=a}else l.cleanHistory()};return B(async()=>{var e;n.multipleDisabled||(_.value="Agregar a la bÃºsqueda");const s={lastPeriod:!0,categoryId:n.baseFilter};if(await g(s),!o.value||o.value.length===0){const a=await N();l.mountListCarceles(a),(e=l.penitenciaria)!=null&&e.id&&!n.multipleDisabled?(i.splice(0,i.length),l.carcelesSelected.map(t=>i.push(t)),o.value=a.filter(t=>t.id!==l.penitenciaria.id),l.removeCarcelesSelected()):o.value=a}n.multipleDisabled?p("executeAction"):p("executeMount")}),(s,e)=>(u(),d("div",$,[h("div",j,[m.monthDisabled?x("",!0):A((u(),d("input",{key:0,class:"periodo-item",type:"month","onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a)},null,512)),[[V,r.value]]),b(M,{options:o.value,modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a)},null,8,["options","modelValue"]),b(y,{title:_.value,onExecuteAction:D,disabled:v.value},null,8,["title","disabled"])]),m.multipleDisabled?x("",!0):(u(),d("div",q,[(u(!0),d(k,null,w(i,a=>(u(),d("div",null,[h("span",null,E(a.description),1),b(y,{title:"X",onExecuteAction:t=>C(a.id)},null,8,["onExecuteAction"])]))),256))]))]))}};export{P as _};
