import{s as h,f as l,D as A,_ as M,a as S,b as I}from"./files-4c47e149.js";import{g as o,u as B,r as R,h as H,i as T,o as d,f as _,j as r,_ as L,m as t,n as q,c as K,N as O,a as v,b as w,K as U}from"./index-e53bf75b.js";import{_ as j}from"./CHeaderBar-8892db25.js";import{_ as J}from"./CFileManagement-ec3019ca.js";import{_ as z}from"./CTable-8a415e52.js";const G=w("i",{class:"large material-icons"},"arrow_upward",-1),P={class:"content-document__section"},g=8,Q=1,te={__name:"MarcoLegal",setup(W){const y=o("Marco legal"),f=o(),i=o(!1),u=o(null),b=B(),c=R({disabledEdit:!1}),C=o([{rowReference:"createdBy",description:"Autor"},{rowReference:"name",description:"Título"},{rowReference:"fechaCreacion",description:"Año"},{rowReference:"resumen",description:"Contenido "}]),D=h(),p=o(D.documentData),F=()=>c.disabledEdit?[{name:"descargar",iconName:"pageview"}]:[{name:"descargar",iconName:"pageview"},{name:"borrar",iconName:"delete_forever"}],N=()=>{b.user.restrictions.filter(a=>a.id===1).length>0?c.disabledEdit=!1:c.disabledEdit=!0},E=()=>{},$=async()=>{const e=new FormData;e.append("archivo",u.value),e.append("categoryId",g),e.append("usrId",Q),e.append("extendedData",JSON.stringify({period:"2023-07"}));const a={ignoreHeader:!0};await l.postFiles(e,a),await m()},k=()=>{f.value.open()},x=async e=>{const a={id:e.request.id};if(e.actionName==="descargar"){const n={id:e.request.id},s={download:!0},V=await l.getFiles(n,s);window.open(V,"_blank")}else e.actionName==="borrar"&&(await l.deleteFiles(a),await dmm.deleteDimensionHistory(a),await m())},m=async()=>{i.value=!0;let e=await l.getFiles({categoryId:g});e=e.map(a=>{let n=A.fromISO(a.createdAt).toFormat("dd/MM/yyyy HH:mm");return a.fechaCreacion=n,a.actions=F(),a}),p.value=e,i.value=!1};return H(async()=>{N(),await m()}),(e,a)=>{const n=T("router-view");return d(),_(L,null,{default:r(()=>[t(j,{title:y.value},null,8,["title"]),t(q,{"active-spin":i.value},null,8,["active-spin"]),c.disabledEdit?v("",!0):(d(),K("button",{key:0,onClick:k,class:"btn agregar__archivo"},[O("Agregar registro "),G])),t(I,{ref_key:"modalForm",ref:f,title:"Subir documento",onClose:E,onSubmit:a[1]||(a[1]=s=>$())},{default:r(()=>[t(M,null,{default:r(()=>[t(S,null,{default:r(()=>[t(J,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=s=>u.value=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512),w("div",P,[t(n,null,{default:r(({Component:s})=>[(d(),_(U,null,[i.value?v("",!0):(d(),_(z,{key:0,columns:C.value,rows:p.value,"actions-active":"",onExecuteActionlist:x},null,8,["columns","rows"]))],1024))]),_:1})])]),_:1})}}};export{te as default};
