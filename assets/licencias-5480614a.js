import{g as n,h as $,o as h,f as x,j as B,_ as k,q as E,l as A,D as P,s as F,b as r,m as l,n as M,y as N,c as j,a as H,e as q}from"./index-1c9b6d67.js";import{_ as U}from"./subSideNav-55c06948.js";import{_ as z}from"./CHeaderBar-902e7fed.js";import{_ as w}from"./CButton-03239594.js";import{_ as G}from"./CTable-a21e50a4.js";import{s as J}from"./filterSituacion-837e74ee.js";import"./CChartDonutSection-613d7e10.js";const K={class:"content-licencia-header"},O={class:"selected-options"},Q={key:0,class:"c-option-volver"},W={class:"table-section-principal"},X={class:"content__section"},u=3,b=29,oe={__name:"licencias",setup(Y){const a=J(),s=n({id:15,description:"Región Metropolitana de Santiago"}),d=n(),c=n(!1),_=n(0),f=n(0),v=n(),g=n("Estado situación carcelaria / Licencias del personal"),V=n([{rowReference:"carcel",description:"Establecimiento penal"},{rowReference:"tieneLicencia",description:"Licencia vigente"},{rowReference:"noLicenciaVigente",description:"Sin licencia vigente"},{rowReference:"licenseTotal",description:"Totales"}]),p=n([]),C=()=>{q.push("/situacionCarcelaria")},L=e=>e?`${Math.round(e*100)/100} %`:"0 %",m=async()=>{try{if(s.value){const e=await S(),t=await E(e);let o=0;p.value=t.map(i=>{const D=a.listadoCarceles.find(T=>T.id==i.carcelId);i.carcel=D.description,i.tieneLicencia=i.licenseActiveTotal,i.noLicenciaVigente=i.licenseDisabledTotal,i.licenseTotal=i.licenseActiveTotal+i.licenseDisabledTotal;const y=i.tieneLicencia/i.licenseTotal*100;return i.porcentajeLicencia=L(y),o+=y,i}),_.value=(o/t.length).toFixed(1)}else p.value=[]}catch(e){console.log(e)}},S=async()=>{var t,o;let e={categoryId:u,historySubCategoryId:b,lastPeriod:!0};return v.value||(v.value=await A(e)),e={categoryId:u,historySubCategoryId:b,historyId:v.value.id,embedLicenses:!0},s.value?e.regionId=(t=s.value)!=null&&t.id?s.value.id:s.value:(o=a==null?void 0:a.regionSelected)!=null&&o.id&&(e.regionId=a.regionSelected.id,s.value=a.regionSelected),f.value&&(e.carcelId=f.value),await I(),e},I=async()=>{if(!a.listadoCarceles.length){const e={regionId:a.regionSelected.id};let t=await P(e);a.setCarcelesList(t)}},R=async e=>{if(!a.listadoRegiones.length>0){let t=await F();d.value=t,a.setRegionesList(t)}else d.value=a.listadoRegiones};return $(async()=>{c.value=!0,s.value=a.regionSelected,await R(),await m(),c.value=!1}),(e,t)=>(h(),x(k,{class:"contenido-licencia"},{default:B(()=>[r("div",K,[l(z,{title:g.value,"section-value":u},null,8,["title"]),l(M,{"active-spin":c.value},null,8,["active-spin"]),r("div",O,[l(N,{class:"select-region",options:d.value,modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o)},null,8,["options","modelValue"]),l(w,{class:"btn-search",title:"",onExecuteAction:m})]),!c.value&&e.topPosition!==0?(h(),j("div",Q,[l(w,{class:"btn-volver",title:"Volver",onExecuteAction:C,disabled:e.blockButton},null,8,["disabled"])])):H("",!0)]),r("div",W,[l(U,{class:"subsection-licencias",title:g.value,"section-value":u,"point-type":2,pointValue:_.value,"point-is-percent":!0,pointTitle:"Dotación efectiva del personal",pointSubtitle:""},null,8,["title","pointValue"]),r("div",X,[l(G,{columns:V.value,rows:p.value},null,8,["columns","rows"])])])]),_:1}))}};export{oe as default};
