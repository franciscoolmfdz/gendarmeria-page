import{g as i,h as J,o as $,f as K,j as O,_ as Q,l as g,q as W,b,m as r,n as X,x as Y,c as Z,a as ee,e as te,C as ae}from"./index-c0c6dc58.js";import{_ as oe}from"./subSideNav-37b119f4.js";import{_ as se}from"./CHeaderBar-c7eae6ad.js";import{_ as L}from"./CButton-5d0fce41.js";import{_ as ie}from"./CTable-d803f6d3.js";import{s as ne}from"./filterSituacion-e456c981.js";import"./CChartDonutSection-22d9718c.js";const le={class:"content-poblacion-header"},re={class:"selected-options"},ce={key:0,class:"c-option-volver"},de={class:"table-section-principal"},ue={class:"content__section"},p=3,B=30,E=29,Ie={__name:"dotacionPoblacion",setup(pe){const h=i("Estado situación carcelaria / Dotación vs población"),s=ne(),y=i(null),n=i({id:15,description:"Región Metropolitana de Santiago"}),I=i([]);i(0);const j=i(0),H=i(),C=i(),v=i(!1),k=i([{description:"Centro penitenciario",colspan:1},{description:"Dotación total",colspan:1},{description:"Total PPL. 24h",colspan:3},{description:"En % relación dotación vs total ppl",colspan:2}]),F=i([{rowReference:"establecimiento",description:""},{rowReference:"dotacionTotal",description:""},{rowReference:"totalPplHombre",description:"Hombre"},{rowReference:"totalPplMujer",description:"Mujer"},{rowReference:"totalPplTotal",description:"Total"},{rowReference:"dotacionRotacion",description:"Cantidad internos por funcionario"},{rowReference:"porcRotacionDotacionInfo",description:"En % relación dotación vs total ppl"}]),f=i([]),c=e=>e<85?"class-verde":e>85&&e<99?"class-ambar":"class-rojo",A=()=>{te.push("/situacionCarcelaria")},d=e=>e?`${Math.round(e*100)/100} %`:"0 %",N=(e,t)=>{const a=s.listadoCarceles.find(o=>o.id===e.carcelId);if(a&&(a!=null&&a.id)){let o=0;t.filter(M=>M.carcelId===a.id).map(M=>o+=M.licenseActiveTotal+M.licenseDisabledTotal);const l=e.imputadoHombre+e.condenadoHombre+e.procesadoHombre+e.detenidoHombre,_=e.imputadoMujer+e.condenadoMujer+e.procesadoMujer+e.detenidoMujer,u=l+_,R=e.imputadoHombre+e.imputadoMujer,m=e.pplMaxMujer+e.pplMaxHombre,x=l&&e.pplMaxHombre?d(l*100/e.pplMaxHombre):0,P=_&&e.pplMaxMujer?d(_*100/e.pplMaxMujer):0,T=u&&m?d(u*100/m):0,D=e.imputadoHombre&&e.pplMaxHombre?d(e.imputadoHombre*100/e.pplMaxHombre):0,S=e.imputadoMujer&&e.pplMaxMujer?d(e.imputadoMujer*100/e.pplMaxMujer):0,V=R&&m?d(R*100/m):0;return{dotacionTotal:o,carcelId:a.id,establecimiento:a.description,imputadoHombre:e.imputadoHombre,imputadoMujer:e.imputadoMujer,imputadoTotal:e.imputadoHombre+e.imputadoMujer,totalPplHombre:l,totalPplMujer:_,totalPplTotal:u,capacidadHombre:e.pplMaxHombre,capacidadMujer:e.pplMaxMujer,capacidadTotal:m,usoCapacidadHombre:{data:x+"%",class:c(x)},usoCapacidadMujer:{data:P+"%",class:c(P)},usoCapacidadTotal:{data:T+"%",class:c(T)},usoImputadoHombre:{data:D+"%",class:c(D)},usoImputadoMujer:{data:S+"%",class:c(S)},usoImputadoTotal:{data:V+"%",class:c(V)},dotacionRotacion:Math.round(u/o),porcRotacionDotacion:Math.round(o/u*100),porcRotacionDotacionInfo:Math.round(o/u*100)+"%"}}},q=async()=>{var a,o,l;let e={categoryId:p,historySubCategoryId:B,lastPeriod:!0};H.value||(H.value=await g(e));let t={categoryId:p,historySubCategoryId:E,lastPeriod:!0};return C.value||(C.value=await g(t)),e={categoryId:p,historySubCategoryId:B,historyId:H.value.id,embedPopulation:!0},t={categoryId:p,historySubCategoryId:E,historyId:C.value.id,embedLicenses:!0},n.value?(e.regionId=(a=n.value)!=null&&a.id?n.value.id:n.value,t.regionId=(o=n.value)!=null&&o.id?n.value.id:n.value):(l=s==null?void 0:s.regionSelected)!=null&&l.id&&(e.regionId=s.regionSelected.id,t.regionId=s.regionSelected.id),j.value&&(e.carcelId=j.value,t.carcelId=j.value),await U(),{filtersPoblacion:e,filtersLicencias:t}},U=async()=>{if(!s.listadoCarceles.length){let e=await ae();s.setCarcelesList(e)}},z=()=>{let e=0;f.value.map(t=>e+=t.porcRotacionDotacion),e=e/f.value.length,y.value=`${parseFloat((e/100*5).toFixed(1))} / 5`},w=async()=>{try{const e=await q();if(n){let t=await g(e.filtersPoblacion),a=await g(e.filtersLicencias);f.value=t.items.map(o=>N(o,(a==null?void 0:a.items)??[])).filter(o=>o),z()}}catch(e){console.log(e)}},G=async e=>{if(!s.listadoRegiones.length>0){let t=await W();I.value=t,s.setRegionesList(t)}else I.value=s.listadoRegiones};return J(async()=>{v.value=!0,n.value=s.regionSelected,await G(),await w(),v.value=!1}),(e,t)=>($(),K(Q,{class:"contenido-dotacion-poblacion"},{default:O(()=>[b("div",le,[r(se,{title:h.value,"section-value":p},null,8,["title"]),r(X,{"active-spin":v.value},null,8,["active-spin"]),b("div",re,[r(Y,{class:"select-region",options:I.value,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a)},null,8,["options","modelValue"]),r(L,{class:"btn-search",title:"",onExecuteAction:w})]),!v.value&&e.topPosition!==0?($(),Z("div",ce,[r(L,{class:"btn-volver",title:"Volver",onExecuteAction:A,disabled:e.blockButton},null,8,["disabled"])])):ee("",!0)]),b("div",de,[r(oe,{class:"subsection-poblacion",title:h.value,"section-value":p,"point-label":y.value,"point-disabled":!0,pointTitle:"Dotación vs población",pointSubtitle:""},null,8,["title","point-label"]),b("div",ue,[r(ie,{"parent-columns":k.value,columns:F.value,rows:f.value},null,8,["parent-columns","columns","rows"])])])]),_:1}))}};export{Ie as default};
