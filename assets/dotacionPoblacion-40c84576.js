import{g as i,h as Q,o as g,f as k,j as W,_ as X,l as b,x as Y,b as C,m as p,n as Z,c as B,C as ee,a as h,e as te,y as ae}from"./index-c5d31a8d.js";import{_ as oe}from"./subSideNav-70a9c1a2.js";import{_ as se}from"./CHeaderBar-cec87e9b.js";import{_ as E}from"./CButton-a8f847be.js";import{_ as ie}from"./CTable-695503ac.js";import{s as le}from"./filterSituacion-3453f87a.js";import"./CChartDonutSection-16a850f5.js";const ne={class:"content-poblacion-header"},re={key:0,class:"selected-options"},ce={key:1,class:"c-option-volver"},de={class:"table-section-principal"},ue={class:"content__section"},m=3,F=30,A=29,je={__name:"dotacionPoblacion",setup(pe){const w=i("Estado situación carcelaria / Dotación vs población"),s=le(),P=i(null),l=i({id:15,description:"Región Metropolitana de Santiago"}),j=i([]);i(0);const H=i(0),I=i(),y=i(),r=i(!1),N=i([{description:"Centro penitenciario",colspan:1},{description:"Dotación total",colspan:1},{description:"Total PPL. 24h",colspan:3},{description:"En % relación dotación vs total ppl",colspan:2}]),U=i([{rowReference:"establecimiento",description:""},{rowReference:"dotacionTotal",description:""},{rowReference:"totalPplHombre",description:"Hombre"},{rowReference:"totalPplMujer",description:"Mujer"},{rowReference:"totalPplTotal",description:"Total"},{rowReference:"dotacionRotacion",description:"Cantidad internos por funcionario"},{rowReference:"porcRotacionDotacionInfo",description:"En % relación dotación vs total ppl"}]),f=i([]),c=e=>e<85?"class-verde":e>85&&e<99?"class-ambar":"class-rojo",q=()=>{te.push("/situacionCarcelaria")},d=e=>e?`${Math.round(e*100)/100} %`:"0 %",z=(e,t)=>{const a=s.listadoCarceles.find(o=>o.id===e.carcelId);if(a&&(a!=null&&a.id)){let o=0;t.filter(_=>_.carcelId===a.id).map(_=>o+=_.licenseActiveTotal+_.licenseDisabledTotal);const n=e.imputadoHombre+e.condenadoHombre+e.procesadoHombre+e.detenidoHombre,M=e.imputadoMujer+e.condenadoMujer+e.procesadoMujer+e.detenidoMujer,u=n+M,x=e.imputadoHombre+e.imputadoMujer,v=e.pplMaxMujer+e.pplMaxHombre,T=n&&e.pplMaxHombre?d(n*100/e.pplMaxHombre):0,D=M&&e.pplMaxMujer?d(M*100/e.pplMaxMujer):0,S=u&&v?d(u*100/v):0,V=e.imputadoHombre&&e.pplMaxHombre?d(e.imputadoHombre*100/e.pplMaxHombre):0,$=e.imputadoMujer&&e.pplMaxMujer?d(e.imputadoMujer*100/e.pplMaxMujer):0,L=x&&v?d(x*100/v):0;return{dotacionTotal:o,carcelId:a.id,establecimiento:a.description,imputadoHombre:e.imputadoHombre,imputadoMujer:e.imputadoMujer,imputadoTotal:e.imputadoHombre+e.imputadoMujer,totalPplHombre:{data:n,class:"ppl-datatable"},totalPplMujer:{data:M,class:"ppl-datatable"},totalPplTotal:{data:u,class:"ppl-datatable"},capacidadHombre:e.pplMaxHombre,capacidadMujer:e.pplMaxMujer,capacidadTotal:v,usoCapacidadHombre:{data:T+"%",class:c(T)},usoCapacidadMujer:{data:D+"%",class:c(D)},usoCapacidadTotal:{data:S+"%",class:c(S)},usoImputadoHombre:{data:V+"%",class:c(V)},usoImputadoMujer:{data:$+"%",class:c($)},usoImputadoTotal:{data:L+"%",class:c(L)},dotacionRotacion:Math.round(u/o),porcRotacionDotacion:Math.round(o/u*100),porcRotacionDotacionInfo:Math.round(o/u*100)+"%"}}},G=async()=>{var a,o,n;let e={categoryId:m,historySubCategoryId:F,lastPeriod:!0};I.value||(I.value=await b(e));let t={categoryId:m,historySubCategoryId:A,lastPeriod:!0};return y.value||(y.value=await b(t)),e={categoryId:m,historySubCategoryId:F,historyId:I.value.id,embedPopulation:!0},t={categoryId:m,historySubCategoryId:A,historyId:y.value.id,embedLicenses:!0},l.value?(e.regionId=(a=l.value)!=null&&a.id?l.value.id:l.value,t.regionId=(o=l.value)!=null&&o.id?l.value.id:l.value):(n=s==null?void 0:s.regionSelected)!=null&&n.id&&(e.regionId=s.regionSelected.id,t.regionId=s.regionSelected.id),H.value&&(e.carcelId=H.value,t.carcelId=H.value),await J(),{filtersPoblacion:e,filtersLicencias:t}},J=async()=>{if(!s.listadoCarceles.length){let e=await ae();s.setCarcelesList(e)}},K=()=>{let e=0;f.value.map(t=>e+=t.porcRotacionDotacion),e=e/f.value.length,P.value=`${parseFloat((e/100*5).toFixed(1))} / 5`.replace(".",",")},R=async()=>{try{const e=await G();if(l){let t=await b(e.filtersPoblacion),a=await b(e.filtersLicencias);f.value=t.items.map(o=>z(o,(a==null?void 0:a.items)??[])).filter(o=>o),K()}}catch(e){console.log(e)}},O=async e=>{if(!s.listadoRegiones.length>0){let t=await Y();j.value=t,s.setRegionesList(t)}else j.value=s.listadoRegiones};return Q(async()=>{r.value=!0,l.value=s.regionSelected,await O(),await R(),r.value=!1}),(e,t)=>(g(),k(X,{class:"contenido-dotacion-poblacion"},{default:W(()=>[C("div",ne,[p(se,{title:w.value,"section-value":m},null,8,["title"]),p(Z,{"active-spin":r.value},null,8,["active-spin"]),r.value?h("",!0):(g(),B("div",re,[r.value?h("",!0):(g(),k(ee,{key:0,class:"select-region",options:j.value,modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a)},null,8,["options","modelValue"])),p(E,{class:"btn-search",title:"",onExecuteAction:R})])),!r.value&&e.topPosition!==0?(g(),B("div",ce,[p(E,{class:"btn-volver",title:"Volver",onExecuteAction:q,disabled:e.blockButton},null,8,["disabled"])])):h("",!0)]),C("div",de,[p(oe,{class:"subsection-poblacion",title:w.value,"section-value":m,"point-label":P.value,"point-disabled":!0,pointTitle:"Dotación vs población",pointSubtitle:""},null,8,["title","point-label"]),C("div",ue,[p(ie,{"parent-columns":N.value,columns:U.value,rows:f.value},null,8,["parent-columns","columns","rows"])])])]),_:1}))}};export{je as default};
