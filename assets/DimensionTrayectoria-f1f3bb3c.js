import{h as s,i as I,r as $,k as A,o as w,f as H,j as l,_ as T,g as o,c as B,B as M,a as J,w as O,v as R,b as p}from"./index-81990198.js";import{_ as P}from"./CHeaderBar-c05e4acb.js";import{d as U,_ as j,a as q}from"./dimensiones-3e6b1616.js";import{s as L,f as m,D as z,_ as G,a as D,b as K}from"./files-18e55635.js";import{_ as Q}from"./CSpinner-bfff3c1b.js";import{_ as W}from"./CTable-236659fc.js";import{c as X}from"./carceles-fea03c35.js";import{d as b}from"./dimensionHistory-2874fc68.js";import"./api-ec658a74.js";const Y=p("i",{class:"large material-icons"},"arrow_upward",-1),Z={class:"content-document__section"},f=7,ee=1,ue={__name:"DimensionTrayectoria",setup(ae){const _=L(),F=s("Dimensión trayectoria"),i=s(!1),h=I(),d=$({disabledEdit:!1}),v=s(_.documentData),N=s([{rowReference:"name",description:"Nombre archivo"},{rowReference:"period",description:"Periodo"},{rowReference:"fechaCreacion",description:"Fecha creación"}]),x=()=>d.disabledEdit?[{name:"descargar",iconName:"pageview"}]:[{name:"descargar",iconName:"pageview"},{name:"borrar",iconName:"delete_forever"}],E=async a=>{i.value=!0;try{const e={id:a.request.id};if(a.actionName==="descargar"){const t={download:!0},n=await m.getFiles(e,t);window.open(n,"_blank")}else a.actionName==="borrar"&&(await m.deleteFiles(e),await b.deleteDimensionHistory(e),await g())}catch(e){console.log(e)}finally{i.value=!1}},y=s(),r=s(null),c=s(null),S=()=>{},C=async()=>{i.value=!0;try{if(r.value&&c.value){const a=JSON.parse(JSON.stringify(r.value.dataFileJson)),e=q(a,f,c.value),t=new FormData;t.append("archivo",r.value.fileElement),t.append("categoryId",f),t.append("usrId",ee),t.append("extendedData",JSON.stringify({period:c.value}));const n={ignoreHeader:!0},u=await m.postFiles(t,n);u!=null&&u.id&&(e.fileId=u.id,await b.postDimensionHistory(e))}}catch(a){console.log(a)}finally{i.value=!1}},V=()=>{y.value.open()},k=()=>{h.user.restrictions.filter(e=>e.id===1).length>0?d.disabledEdit=!1:d.disabledEdit=!0},g=async()=>{let a=await m.getFiles({categoryId:f});a=a.map(e=>{var n;e.actions=x();let t=z.fromISO(e.createdAt).toFormat("dd/MM/yyyy HH:mm");return e.fechaCreacion=t,e.period=(n=e==null?void 0:e.extendedData)==null?void 0:n.period,e}),v.value=a};return A(async()=>{k(),await g();const a=await X.getCarceles(),e=await U.getDimensiones({categoryId:f});_.mountParameters(e,a)}),(a,e)=>(w(),H(T,null,{default:l(()=>[o(Q,{"active-spin":i.value},null,8,["active-spin"]),o(P,{title:F.value},null,8,["title"]),d.disabledEdit?J("",!0):(w(),B("button",{key:0,onClick:V,class:"btn agregar__archivo"},[M("Agregar registro "),Y])),o(K,{ref_key:"modalForm",ref:y,title:"Subir documento",onClose:S,onSubmit:C},{default:l(()=>[o(G,{title:""},{default:l(()=>[o(D,{title:"Archivo"},{default:l(()=>[o(j,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t)},null,8,["modelValue"])]),_:1}),o(D,{title:"Periodo",class:"c-periodo"},{default:l(()=>[O(p("input",{class:"periodo-item",type:"month","onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t)},null,512),[[R,c.value]])]),_:1})]),_:1})]),_:1},512),p("div",Z,[o(W,{columns:N.value,rows:v.value,"actions-active":"",onExecuteActionlist:E},null,8,["columns","rows"])])]),_:1}))}};export{ue as default};
