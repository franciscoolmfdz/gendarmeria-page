import{r as g,u as M,g as p,h as E,z as R,o as n,c,b as x,w as L,v as N,a as v,f as D,A as $,m as A,F as q,p as T,t as U,e as _,l as j}from"./index-55c36585.js";import{_ as y}from"./CButton-f23aba14.js";const z={class:"c-filterbar"},O={class:"selected-options"},P={key:0,class:"selected-centros"},X={class:"select-centro-content"},G={key:1,class:"c-option-volver"},K={__name:"CFilterbar",props:{baseFilter:{type:[Object,Number,String],required:!0},multipleDisabled:{type:Boolean,default:!0},monthDisabled:{type:Boolean,default:!1}},emits:["executeAction","executeRemove","executeMount"],setup(h,{emit:m}){const i=h,f=g({disabledCentros:!1}),a=M(),S=p("Buscar"),b=p(!1),C=p(a.penitenciaria),o=g([]),u=p(a.periodo),V=s=>{const e=o.filter(l=>l.id===s);r.value.push(e[0]),r.value.sort((l,d)=>l.id<d.id);const t=o.filter(l=>l.id!==s);o.splice(0,o.length),t.map(l=>o.push(l)),a.removeCarcelSelected(s),m("executeRemove",s)},k=()=>i.baseFilter===1||i.baseFilter===2||i.baseFilter===7,B=()=>{i.baseFilter===1?_.push("/vidaInternosMain"):i.baseFilter===2?_.push("/vidaFuncionariosMain"):i.baseFilter===7&&_.push("/dimensionTrayectoria")},I=async()=>{const s=r.value.filter(l=>l.id===C.value)[0];!i.multipleDisabled&&s&&(o.push(s),r.value=r.value.filter(l=>l.id!==s.id),a.removeCarcelesSelected());const e=u.value.split("-"),t={year:e[0],month:e[1],categoryId:i.baseFilter};await F(t),a.changeCriteria({periodo:u.value,penitenciaria:s??r[0]}),m("executeAction")},r=p(a.listadoCarceles),F=async s=>{b.value=!0;const e=await j(s);if(b.value=!1,e&&(e!=null&&e.period)&&(e!=null&&e.id)){const{period:t=null,id:l=null}=e;a.mountBaseHistory({period:t,id:l}),u.value=t}else a.cleanHistory()},w=()=>{const s=a.user.restrictions.find(t=>t.typeId===2),e=a.user.restrictions.find(t=>t.typeId===3);if(!s&&!e)return{};if(s)return f.disabledCentros=!1,{regionId:parseInt(s.restriction)};if(e)return f.disabledCentros=!0,{carcelIds:parseInt(e.restriction)}};return E(async()=>{var t;i.multipleDisabled||(S.value="Agregar a la bÃºsqueda");const s={lastPeriod:!0,categoryId:i.baseFilter},e=w();if(await F(s),!r.value||r.value.length===0){const l=await R(e);a.mountListCarceles(l),(t=a.penitenciaria)!=null&&t.id&&!i.multipleDisabled?(o.splice(0,o.length),a.carcelesSelected.map(d=>o.push(d)),r.value=l.filter(d=>d.id!==a.penitenciaria.id),a.removeCarcelesSelected()):r.value=l}i.multipleDisabled?m("executeAction"):m("executeMount")}),(s,e)=>(n(),c("div",z,[x("div",O,[h.monthDisabled?v("",!0):L((n(),c("input",{key:0,class:"periodo-item",type:"month","onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t)},null,512)),[[N,u.value]]),f.disabledCentros?v("",!0):(n(),D($,{key:1,class:"c-select-item",options:r.value,modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t)},null,8,["options","modelValue"])),A(y,{class:"c-filterbar-search",title:"",onExecuteAction:I,disabled:b.value},null,8,["disabled"])]),h.multipleDisabled?v("",!0):(n(),c("div",P,[(n(!0),c(q,null,T(o,t=>(n(),c("div",X,[x("span",null,U(t.description),1),f.disabledCentros?v("",!0):(n(),D(y,{key:0,class:"deleted-centro",title:"X",onExecuteAction:l=>V(t.id)},null,8,["onExecuteAction"]))]))),256))])),k()?(n(),c("div",G,[A(y,{class:"btn-volver-filter",title:"Volver",onExecuteAction:B,disabled:b.value},null,8,["disabled"])])):v("",!0)]))}};export{K as _};
