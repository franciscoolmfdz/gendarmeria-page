import{r as g,u as I,g as d,h as V,o,c as p,b as h,w as A,v as w,a as f,f as x,l as R,F as E,y as L,n as M,t as N}from"./index-b9c74f25.js";import{_ as D}from"./CSelect.vue_vue_type_style_index_0_lang-9aa73486.js";import{_ as $}from"./CSelect-0254b8e1.js";import{g as q}from"./carceles-7aded4be.js";const U={class:"c-filterbar"},j={class:"selected-options"},O={key:0,class:"selected-centros"},P={class:"select-centro-content"},H={__name:"CFilterbar",props:{baseFilter:{type:[Object,Number,String],required:!0},multipleDisabled:{type:Boolean,default:!0},monthDisabled:{type:Boolean,default:!1}},emits:["executeAction","executeRemove","executeMount"],setup(b,{emit:m}){const n=b,v=g({disabledCentros:!1}),l=I(),F=d("Buscar"),C=d(!1),_=d(l.penitenciaria),r=g([]),c=d(l.periodo),B=a=>{const e=r.filter(s=>s.id===a);i.value.push(e[0]),i.value.sort((s,u)=>s.id<u.id);const t=r.filter(s=>s.id!==a);r.splice(0,r.length),t.map(s=>r.push(s)),m("executeRemove",a)},S=async()=>{const a=i.value.filter(s=>s.id===_.value)[0];!n.multipleDisabled&&a&&(r.push(a),i.value=i.value.filter(s=>s.id!==a.id),l.removeCarcelesSelected());const e=c.value.split("-"),t={year:e[0],month:e[1],categoryId:n.baseFilter};await y(t),l.changeCriteria({periodo:c.value,penitenciaria:a??i[0]}),m("executeAction")},i=d(l.listadoCarceles),y=async a=>{C.value=!0;const e=await M(a);if(C.value=!1,e&&(e!=null&&e.period)&&(e!=null&&e.id)){const{period:t=null,id:s=null}=e;l.mountBaseHistory({period:t,id:s}),c.value=t}else l.cleanHistory()},k=()=>{const a=l.user.restrictions.find(t=>t.typeId===2),e=l.user.restrictions.find(t=>t.typeId===3);if(!a&&!e)return{};if(a)return v.disabledCentros=!1,{regionId:parseInt(a.restriction)};if(e)return v.disabledCentros=!0,{carcelIds:parseInt(e.restriction)}};return V(async()=>{var t;n.multipleDisabled||(F.value="Agregar a la bÃºsqueda");const a={lastPeriod:!0,categoryId:n.baseFilter},e=k();if(await y(a),!i.value||i.value.length===0){const s=await q(e);l.mountListCarceles(s),(t=l.penitenciaria)!=null&&t.id&&!n.multipleDisabled?(r.splice(0,r.length),l.carcelesSelected.map(u=>r.push(u)),i.value=s.filter(u=>u.id!==l.penitenciaria.id),l.removeCarcelesSelected()):i.value=s}n.multipleDisabled?m("executeAction"):m("executeMount")}),(a,e)=>(o(),p("div",U,[h("div",j,[b.monthDisabled?f("",!0):A((o(),p("input",{key:0,class:"periodo-item",type:"month","onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t)},null,512)),[[w,c.value]]),v.disabledCentros?f("",!0):(o(),x($,{key:1,class:"c-select-item",options:i.value,modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t)},null,8,["options","modelValue"])),R(D,{class:"c-filterbar-search",title:"",onExecuteAction:S,disabled:C.value},null,8,["disabled"])]),b.multipleDisabled?f("",!0):(o(),p("div",O,[(o(!0),p(E,null,L(r,t=>(o(),p("div",P,[h("span",null,N(t.description),1),v.disabledCentros?f("",!0):(o(),x(D,{key:0,class:"deleted-centro",title:"X",onExecuteAction:s=>B(t.id)},null,8,["onExecuteAction"]))]))),256))]))]))}};export{H as _};
