import{s as C,f as g,D as J,_ as L,a as y,b as $}from"./files-438e7873.js";import{u as k,g as u,r as x,h as U,M as P,i as N,o as A,f as T,j as p,_ as j,m as s,c as w,N as G,a as Y,x as K,b as M,K as q,O as b}from"./index-f4124e79.js";import{_ as z}from"./CHeaderBar-e62534a5.js";import{_ as Z}from"./ManagementXLS-99485315.js";import{_ as Q}from"./CTable-149f3711.js";const W=C(),X=e=>W.carcelesList.find(l=>{if(l.adicionalCode&&parseInt(l.adicionalCode)===parseInt(e)||parseInt(l.code)===parseInt(e))return l}),ee=e=>{if(e==="PS")return 1;if(e==="TS_AS")return 2},te=(e,o)=>{const t=X(e.CODIGO_ESTABLECIMIENTO);if(o===32)return{subCategoryId:o,categoryId:3,carcelId:(t==null?void 0:t.id)??null,regionId:(t==null?void 0:t.regionId)??null,dataEnero:e.ENERO,dataFebrero:e.FEBRERO,dataMarzo:e.MARZO,dataAbril:e.ABRIL,dataMayo:e.MAYO,dataJunio:e.JUNIO,dataJulio:e.JULIO,dataAgosto:e.AGOSTO,dataSeptiembre:e.SEPTIEMBRE,dataOctubre:e.OCTUBRE,dataNoviembre:e.NOVIEMBRE,dataDiciembre:e.DICIEMBRE,leyVeinteMil:e.LEY_20000};if(o===30)return{carcelId:(t==null?void 0:t.id)??null,regionId:(t==null?void 0:t.regionId)??null,profesionalHombre:null,profesionalMujer:null,profesionalType:null};if(o===28)return{carcelId:(t==null?void 0:t.id)??null,regionId:(t==null?void 0:t.regionId)??null,profesionalHombre:e.CANTIDAD_HOMBRE,profesionalMujer:e.CANTIDAD_MUJER,profesionalTypeId:ee(e.TIPO_TRABAJADOR)};if(o===29)return{carcelId:(t==null?void 0:t.id)??null,regionId:(t==null?void 0:t.regionId)??null,licenseActiveTotal:e.CANTIDAD_SI,licenseDisabledTotal:e.CANTIDAD_NO,subCategoryId:o,categoryId:3}},ae=(e,o,t,l,_)=>{let f={period:l,hYear:l,hMonth:null,userId:_,categoryId:o,subCategoryId:t,fileId:null,items:[]};for(let i=0;i<e.length;i++){e[i].carcel??e[i].CODIGO_ESTABLECIMIENTO;const m=te(e[i],t);f.items.push(m)}return f};const ne=M("i",{class:"large material-icons"},"arrow_upward",-1),oe={class:"content-document__section"},D=3,ce={__name:"SituacionCarcelaria",setup(e){const o=k(),t=C(),l=u("Estado situaciÃ³n carcelaria"),_=o.user.id,f=u(),i=u(null),m=x({disabledEdit:!1}),S=u([{rowReference:"name",description:"Nombre archivo"},{rowReference:"fechaCreacion",description:"Fecha de carga"}]),O=u(t.documentData),F=u([{id:27,description:"Registro de eventos"},{id:28,description:"Asistentes y psicologos"},{id:29,description:"Licencias"},{id:30,description:"% Imputados"},{id:32,description:"Ley 20.000"}]),I=u({}),R=()=>m.disabledEdit?[{name:"descargar",iconName:"pageview"}]:[{name:"descargar",iconName:"pageview"},{name:"borrar",iconName:"delete_forever"}],h=()=>{o.user.restrictions.filter(a=>a.id===1).length>0?m.disabledEdit=!1:m.disabledEdit=!0},B=async()=>{if(i.value&&I.value){const n=JSON.parse(JSON.stringify(i.value.dataFileJson)),a=n[0].ANIO,d=ae(n,D,I.value,a,_),r=new FormData;r.append("archivo",i.value.fileElement),r.append("categoryId",D),r.append("usrId",_),r.append("extendedData",JSON.stringify({period:"2023-07"}));const c={ignoreHeader:!0},v=await g.postFiles(r,c);v!=null&&v.id&&(d.fileId=v.id,await b.postDimensionHistory(d)),await E()}},V=()=>{f.value.open()},H=async n=>{const a={id:n.request.id};if(n.actionName==="descargar"){const d={download:!0},r=await g.getFiles(a,d);window.open(r,"_blank")}else n.actionName==="borrar"&&(await g.deleteFiles(a),await b.deleteDimensionHistory(a),await E())},E=async()=>{let n=await g.getFiles({categoryId:D});n=n.map(a=>{let d=J.fromISO(a.createdAt).toFormat("dd/MM/yyyy HH:mm");return a.fechaCreacion=d,a.actions=R(),a}),O.value=n};return U(async()=>{h(),await E();const n=await P.getCarceles();t.mountParameters(null,n)}),(n,a)=>{const d=N("c-spinner"),r=N("router-view");return A(),T(j,null,{default:p(()=>[s(d,{"active-spin":n.activeSpin},null,8,["active-spin"]),s(z,{title:l.value},null,8,["title"]),m.disabledEdit?Y("",!0):(A(),w("button",{key:0,onClick:V,class:"btn agregar__archivo"},[G("Agregar registro "),ne])),s($,{ref_key:"modalForm",ref:f,title:"Subir documento",onClose:n.onClose,onSubmit:a[2]||(a[2]=c=>B())},{default:p(()=>[s(L,null,{default:p(()=>[s(y,{title:"Tipo de archivo"},{default:p(()=>[s(K,{options:F.value,modelValue:I.value,"onUpdate:modelValue":a[0]||(a[0]=c=>I.value=c)},null,8,["options","modelValue"])]),_:1}),s(y,{title:"Archivo"},{default:p(()=>[s(Z,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=c=>i.value=c)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onClose"]),M("div",oe,[s(r,null,{default:p(({Component:c})=>[(A(),T(q,null,[s(Q,{columns:S.value,rows:O.value,"actions-active":"",onExecuteActionlist:H},null,8,["columns","rows"])],1024))]),_:1})])]),_:1})}}};export{ce as default};
