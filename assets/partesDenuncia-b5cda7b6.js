import{_ as Y}from"./CColunmChart-7681df41.js";import{u as H,g as t,r as j,h as U,o as p,f as w,j as q,_ as G,x as K,l as M,b as f,m as c,n as Q,c as x,C as W,a as b,e as Z,y as ee}from"./index-517d81b5.js";import{_ as ae}from"./CHeaderBar-9e488358.js";import{_ as te}from"./subSideNav-e8b173ec.js";import{_ as V}from"./CButton-9d782e0a.js";import{_ as oe}from"./CTable-3edd57c8.js";import{s as se}from"./filterSituacion-cc2f1baa.js";import"./CChartDonutSection-682f2bb4.js";const le={class:"content-header-partes"},ne={key:0,class:"selected-options"},re={key:1,class:"c-option-volver"},ie={class:"table-section-principal"},ce={class:"content__section"},de={class:"chart-section"},_=3,P=32,me={__name:"partesDenuncia",setup(ue){const l=se(),m=H(),r=t(!1),n=t({id:15,description:"Región Metropolitana de Santiago"}),g=t([]),R=t([]),y=t(0),i=t(null),d=t(null),u=t(""),I=t(""),S=t("Estado situación carcelaria / Partes denuncia ley 20.000"),$=t([{description:"Centro penitenciario",colspan:1},{description:I,colspan:12},{description:"Resumen",colspan:3}]),O=t([{rowReference:"establecimiento",description:"Establecimiento"},{rowReference:"dataEnero",description:"1"},{rowReference:"dataFebrero",description:"2"},{rowReference:"dataMarzo",description:"3"},{rowReference:"dataAbril",description:"4"},{rowReference:"dataMayo",description:"5"},{rowReference:"dataJunio",description:"6"},{rowReference:"dataJulio",description:"7"},{rowReference:"dataAgosto",description:"8"},{rowReference:"dataSeptiembre",description:"9"},{rowReference:"dataOctubre",description:"10"},{rowReference:"dataNoviembre",description:"11"},{rowReference:"dataDiciembre",description:"12"},{rowReference:"otros",description:"Otros"},{rowReference:"leyVeinteMil",description:"Ley 20.000"},{rowReference:"total",description:"Total"}]),h=t([]),E=t({}),F=t({}),k=t({series:{allowPointSelect:!0,showInLegend:!0,cursor:"pointer",dataLabels:{enabled:!0,distance:-40,format:"{point.percentage:.1f}%",style:{fontSize:"1.2em",textOutline:"none",opacity:.7},filter:{operator:">",property:"percentage",value:10}}}}),J=t({}),v=j([{name:"Totales",colorByPoint:!0,data:[]}]),L=()=>{Z.push("/situacionCarcelaria")},T=async()=>{l.changeRegionSelected(n.value),await A(),await C()},B=async a=>{if(!l.listadoRegiones.length>0){let o={regionId:null};i.value&&(o.regionId=i.value);let s=await K(o);g.value=s,l.setRegionesList(s)}else g.value=l.listadoRegiones},A=async()=>{let a=await ee();R.value=a},N=async()=>{var o,s;let a={categoryId:_,historySubCategoryId:P,lastPeriod:!0};return y.value||(y.value=await M(a)),a={categoryId:_,historySubCategoryId:P,historyId:y.value.id,embedLawParts:!0},n.value?a.regionId=(o=n.value)!=null&&o.id?n.value.id:n.value:(s=l==null?void 0:l.regionSelected)!=null&&s.id&&(a.regionId=l.regionSelected.id,n.value=l.regionSelected),i.value&&(a.regionId=i.value),d.value&&(a.carcelId=d.value),await A(),a},C=async()=>{try{let a=0,o=0;u.value=0;const s=await N(),D=await M(s);I.value=`Año ${D.period}`,h.value=D.items.map(e=>{console.log(e.carcelId);const z=R.value.find(X=>X.id==e.carcelId);return e.establecimiento=z.description,e.total=e.dataEnero+e.dataFebrero+e.dataMarzo+e.dataAbril+e.dataMayo+e.dataJunio+e.dataJulio+e.dataAgosto+e.dataSeptiembre+e.dataOctubre+e.dataNoviembre+e.dataDiciembre,e.otros=e.total-e.leyVeinteMil,a+=e.leyVeinteMil,e.dataEnero={class:"color-mes",data:e.dataEnero},e.dataFebrero={class:"color-mes",data:e.dataFebrero},e.dataMarzo={class:"color-mes",data:e.dataMarzo},e.dataAbril={class:"color-mes",data:e.dataAbril},e.dataMayo={class:"color-mes",data:e.dataMayo},e.dataJunio={class:"color-mes",data:e.dataJunio},e.dataJulio={class:"color-mes",data:e.dataJulio},e.dataAgosto={class:"color-mes",data:e.dataAgosto},e.dataSeptiembre={class:"color-mes",data:e.dataSeptiembre},e.dataOctubre={class:"color-mes",data:e.dataOctubre},e.dataNoviembre={class:"color-mes",data:e.dataNoviembre},e.dataDiciembre={class:"color-mes",data:e.dataDiciembre},o+=e.otros,u.value+=e.total,e.total={class:"color-mes",data:e.total},e}),u.value=`Total: ${u.value}`,v[0].data=[],v[0].data.push({name:"Otros",y:o}),v[0].data.push({name:"Ley 20.000",y:a})}catch(a){console.log(a)}};return U(async()=>{r.value=!0,n.value=l.regionSelected;const a=m.user.restrictions.find(s=>s.typeId===2),o=m.user.restrictions.find(s=>s.typeId===3);a?i.value=parseInt(a.restriction):o?d.value=parseInt(o.restriction):(d.value=null,i.value=null),n.value=l.regionSelected.value,await B(),await C(),r.value=!1}),(a,o)=>(p(),w(G,{class:"contenido-partes"},{default:q(()=>[f("div",le,[c(ae,{title:S.value,"section-value":_},null,8,["title"]),c(Q,{"active-spin":r.value},null,8,["active-spin"]),!r.value&&!d.value?(p(),x("div",ne,[r.value?b("",!0):(p(),w(W,{key:0,class:"select-region",options:g.value,modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value=s),disabled:i.value},null,8,["options","modelValue","disabled"])),c(V,{class:"btn-search",title:"",onExecuteAction:o[1]||(o[1]=s=>T())})])):b("",!0),!r.value&&a.topPosition!==0?(p(),x("div",re,[c(V,{class:"btn-volver",title:"Volver",onExecuteAction:L,disabled:a.blockButton},null,8,["disabled"])])):b("",!0)]),f("div",ie,[c(te,{class:"subsection-partes",title:S.value,"section-value":_,"point-label":u.value,pointTitle:"Partes denuncia ley 20.000",pointSubtitle:"","point-disabled":!0},null,8,["title","point-label"]),f("div",ce,[c(oe,{"parent-columns":$.value,columns:O.value,rows:h.value},null,8,["parent-columns","columns","rows"]),f("div",de,[r.value?b("",!0):(p(),w(Y,{key:0,chartType:"pie",optionsAxisX:E.value,optionsAxisY:F.value,plotOptions:k.value,tooltip:J.value,series:v},null,8,["optionsAxisX","optionsAxisY","plotOptions","tooltip","series"]))])])])]),_:1}))}};export{me as default};
