import{u as ne,g as n,r as le,h as se,i as re,o as m,f as y,j as l,_ as ue,m as o,n as ce,b as s,c as T,I as H,a as V,w as p,v as f,K as J}from"./index-9fb49b6f.js";import{s as de,f as c,D as K,_ as O,a as d,b as Q}from"./files-25828624.js";import{_ as ie}from"./CHeaderBar-99e7b8d1.js";import{_ as j}from"./CFileManagement-1ca48b2f.js";import{_ as z}from"./CTable-e6bf1a6d.js";const me={class:"section-table-articulo"},pe=s("i",{class:"large material-icons"},"arrow_upward",-1),fe={class:"content-document__section"},ve={class:"section-table-norma"},_e=s("i",{class:"large material-icons"},"arrow_upward",-1),ge={class:"content-document__section"},G=8,P=9,Ne={__name:"MarcoLegal",setup(ye){const k=ne(),W=n("Marco legal"),A=k.user.id,B=n(),E=n(),i=n(!1),w=n(null),x=n(null),b=n(null),C=n(null),h=n(null),I=n(null),D=n(null),N=n(null),v=le({disabledEdit:!1}),M=n([{rowReference:"createdBy",description:"Autor"},{rowReference:"name",description:"Nombre de archivo"},{rowReference:"fecha",description:"Fecha"},{rowReference:"resumen",description:"ContenidoÂ "}]),U=de(),$=n(U.documentData),L=n(U.documentDataNorma),R=()=>v.disabledEdit?[{name:"descargar",iconName:"pageview"}]:[{name:"descargar",iconName:"pageview"}],X=()=>{k.user.restrictions.filter(e=>e.id===1).length>0?v.disabledEdit=!1:v.disabledEdit=!0},q=()=>{},Y=async()=>{const a=new FormData;a.append("archivo",w.value),a.append("categoryId",G),a.append("usrId",A),a.append("extendedData",JSON.stringify({createdBy:b.value,resumen:D.value,fecha:C.value}));const e={ignoreHeader:!0};await c.postFiles(a,e),await S()},Z=async()=>{const a=new FormData;a.append("archivo",x.value),a.append("categoryId",P),a.append("usrId",A),a.append("extendedData",JSON.stringify({createdBy:h.value,resumen:N.value,fecha:I.value}));const e={ignoreHeader:!0};await c.postFiles(a,e),await F()},ee=()=>{B.value.open()},ae=()=>{E.value.open()},te=async a=>{const e={id:a.request.id};if(a.actionName==="descargar"){const r={id:a.request.id},t={download:!0},u=await c.getFiles(r,t);window.open(u,"_blank"),await mountData()}else a.actionName==="borrar"&&(await c.deleteFiles(e),await S())},oe=async a=>{const e={id:a.request.id};if(a.actionName==="descargar"){const r={id:a.request.id},t={download:!0},u=await c.getFiles(r,t);window.open(u,"_blank"),await F()}else a.actionName==="borrar"&&(await c.deleteFiles(e),await F())},F=async()=>{i.value=!0,x.value=null,h.value=null,N.value=null;let a=await c.getFiles({categoryId:P});a=a.map(e=>{var t,u,_,g;const r=(t=e==null?void 0:e.extendedData)!=null&&t.fecha?K.fromSQL(((u=e==null?void 0:e.extendedData)==null?void 0:u.fecha)+"-01 00:00:00").toFormat("MM-yyyy"):"";return e.fecha=r,e.createdBy=(_=e.extendedData)==null?void 0:_.createdBy,e.resumen=(g=e.extendedData)==null?void 0:g.resumen,e.actions=R(),e}),L.value=a,i.value=!1},S=async()=>{i.value=!0,w.value=null,b.value=null,D.value=null;let a=await c.getFiles({categoryId:G});a=a.map(e=>{var t,u,_,g;const r=(t=e==null?void 0:e.extendedData)!=null&&t.fecha?K.fromSQL(((u=e==null?void 0:e.extendedData)==null?void 0:u.fecha)+"-01 00:00:00").toFormat("MM-yyyy"):"";return e.fecha=r,e.createdBy=(_=e.extendedData)==null?void 0:_.createdBy,e.resumen=(g=e.extendedData)==null?void 0:g.resumen,e.actions=R(),e}),$.value=a,i.value=!1};return se(async()=>{X(),await S(),await F()}),(a,e)=>{const r=re("router-view");return m(),y(ue,{class:"table-marco-legal"},{default:l(()=>[o(ie,{title:W.value},null,8,["title"]),o(ce,{"active-spin":i.value},null,8,["active-spin"]),s("div",me,[v.disabledEdit?V("",!0):(m(),T("button",{key:0,onClick:ee,class:"btn agregar__archivo-articulo"},[H("Agregar articulo "),pe])),o(Q,{ref_key:"modalForm",ref:B,title:"Subir documento",onClose:q,onSubmit:Y},{default:l(()=>[o(O,null,{default:l(()=>[o(d,{title:"Archivo"},{default:l(()=>[o(j,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),o(d,{title:"Autor"},{default:l(()=>[p(s("input",{class:"search__content--text","onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t),placeholder:"Ingresar autor",type:"text"},null,512),[[f,b.value]])]),_:1}),o(d,{title:"Fecha",class:"c-periodo"},{default:l(()=>[p(s("input",{class:"periodo-item",type:"month","onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t)},null,512),[[f,C.value]])]),_:1}),o(d,{title:"Contenido"},{default:l(()=>[p(s("textarea",{class:"search__content--text","onUpdate:modelValue":e[3]||(e[3]=t=>D.value=t),placeholder:"Ingresar resumen del contenido",type:"text",maxlength:"100"},`\r
        `,512),[[f,D.value]])]),_:1})]),_:1},512),s("div",fe,[o(r,null,{default:l(({Component:t})=>[(m(),y(J,null,[i.value?V("",!0):(m(),y(z,{key:0,columns:M.value,rows:$.value,"actions-active":"",onExecuteActionlist:te},null,8,["columns","rows"]))],1024))]),_:1})])]),s("div",ve,[v.disabledEdit?V("",!0):(m(),T("button",{key:0,onClick:ae,class:"btn agregar__archivo-articulo-norma"},[H("Agregar norma "),_e])),o(Q,{ref_key:"modalFormNorma",ref:E,title:"Subir documento",onClose:q,onSubmit:Z},{default:l(()=>[o(O,null,{default:l(()=>[o(d,{title:"Archivo"},{default:l(()=>[o(j,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=t=>x.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),o(d,{title:"Autor"},{default:l(()=>[p(s("input",{class:"search__content--text","onUpdate:modelValue":e[5]||(e[5]=t=>h.value=t),placeholder:"Ingresar autor",type:"text"},null,512),[[f,h.value]])]),_:1}),o(d,{title:"Fecha",class:"c-periodo"},{default:l(()=>[p(s("input",{class:"periodo-item",type:"month","onUpdate:modelValue":e[6]||(e[6]=t=>I.value=t)},null,512),[[f,I.value]])]),_:1}),o(d,{title:"Contenido"},{default:l(()=>[p(s("textarea",{class:"search__content--text","onUpdate:modelValue":e[7]||(e[7]=t=>N.value=t),placeholder:"Ingresar resumen del contenido",type:"text",maxlength:"100"},`\r
            `,512),[[f,N.value]])]),_:1})]),_:1},512),s("div",ge,[o(r,null,{default:l(({Component:t})=>[(m(),y(J,null,[i.value?V("",!0):(m(),y(z,{key:0,columns:M.value,rows:L.value,"actions-active":"",onExecuteActionlist:oe},null,8,["columns","rows"]))],1024))]),_:1})])])]),_:1})}}};export{Ne as default};
