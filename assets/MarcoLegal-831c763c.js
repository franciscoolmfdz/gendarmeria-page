import{u as ee,g as n,r as te,h as ae,i as oe,o as d,f as g,j as l,_ as ne,m as o,n as le,b as r,c as $,I as H,a as b,w as x,v as N,K as R}from"./index-c9e0618f.js";import{s as se,f as c,D as q,_ as O,a as p,b as T}from"./files-ef54c6cf.js";import{_ as re}from"./CHeaderBar-331bbde6.js";import{_ as L}from"./CFileManagement-ffc964f4.js";import{_ as J}from"./CTable-d7ed76f0.js";const ie={class:"section-table-articulo"},ce=r("i",{class:"large material-icons"},"arrow_upward",-1),ue={class:"content-document__section"},de={class:"section-table-norma"},me=r("i",{class:"large material-icons"},"arrow_upward",-1),_e={class:"content-document__section"},K=8,j=9,be={__name:"MarcoLegal",setup(pe){const h=ee(),z=n("Marco legal"),F=h.user.id,C=n(),A=n(),u=n(!1),v=n(null),y=n(null),m=n(null),I=n(null),_=n(null),V=n(null),f=te({disabledEdit:!1}),k=n([{rowReference:"createdBy",description:"Autor"},{rowReference:"name",description:"Nombre de archivo"},{rowReference:"fechaCreacion",description:"Año"},{rowReference:"resumen",description:"Contenido "}]),S=se(),B=n(S.documentData),E=n(S.documentDataNorma),M=()=>f.disabledEdit?[{name:"descargar",iconName:"pageview"}]:[{name:"descargar",iconName:"pageview"},{name:"borrar",iconName:"delete_forever"}],G=()=>{h.user.restrictions.filter(e=>e.id===1).length>0?f.disabledEdit=!1:f.disabledEdit=!0},U=()=>{},P=async()=>{console.log(v.value);const t=new FormData;t.append("archivo",v.value),t.append("categoryId",K),t.append("usrId",F),t.append("extendedData",JSON.stringify({createdBy:m.value,resumen:_.value}));const e={ignoreHeader:!0};await c.postFiles(t,e),await D()},Q=async()=>{const t=new FormData;t.append("archivo",y.value),t.append("categoryId",j),t.append("usrId",F),t.append("extendedData",JSON.stringify({createdBy:I.value,resumen:V.value}));const e={ignoreHeader:!0};await c.postFiles(t,e),await w()},W=()=>{C.value.open()},X=()=>{A.value.open()},Y=async t=>{const e={id:t.request.id};if(t.actionName==="descargar"){const s={id:t.request.id},a={download:!0},i=await c.getFiles(s,a);window.open(i,"_blank"),await mountData()}else t.actionName==="borrar"&&(await c.deleteFiles(e),await D())},Z=async t=>{const e={id:t.request.id};if(t.actionName==="descargar"){const s={id:t.request.id},a={download:!0},i=await c.getFiles(s,a);window.open(i,"_blank"),await w()}else t.actionName==="borrar"&&(await c.deleteFiles(e),await w())},w=async()=>{u.value=!0,y.value=null,I.value=null,V.value=null;let t=await c.getFiles({categoryId:j});t=t.map(e=>{var a,i;let s=q.fromISO(e.createdAt).toFormat("dd/MM/yyyy HH:mm");return e.fechaCreacion=s,e.createdBy=(a=e.extendedData)==null?void 0:a.createdBy,e.resumen=(i=e.extendedData)==null?void 0:i.resumen,e.actions=M(),e}),E.value=t,u.value=!1},D=async()=>{u.value=!0,v.value=null,m.value=null,_.value=null;let t=await c.getFiles({categoryId:K});t=t.map(e=>{var a,i;let s=q.fromISO(e.createdAt).toFormat("dd/MM/yyyy HH:mm");return e.fechaCreacion=s,e.createdBy=(a=e.extendedData)==null?void 0:a.createdBy,e.resumen=(i=e.extendedData)==null?void 0:i.resumen,e.actions=M(),e}),B.value=t,u.value=!1};return ae(async()=>{G(),await D(),await w()}),(t,e)=>{const s=oe("router-view");return d(),g(ne,{class:"table-marco-legal"},{default:l(()=>[o(re,{title:z.value},null,8,["title"]),o(le,{"active-spin":u.value},null,8,["active-spin"]),r("div",ie,[f.disabledEdit?b("",!0):(d(),$("button",{key:0,onClick:W,class:"btn agregar__archivo-articulo"},[H("Agregar articulo "),ce])),o(T,{ref_key:"modalForm",ref:C,title:"Subir documento",onClose:U,onSubmit:P},{default:l(()=>[o(O,null,{default:l(()=>[o(p,{title:"Archivo"},{default:l(()=>[o(L,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a)},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{title:"Autor"},{default:l(()=>[x(r("input",{class:"search__content--text","onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),placeholder:"Ingresar autor",type:"text"},null,512),[[N,m.value]])]),_:1}),o(p,{title:"Contenido"},{default:l(()=>[x(r("textarea",{class:"search__content--text","onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),placeholder:"Ingresar resumen del contenido",type:"text",maxlength:"100"},`\r
					`,512),[[N,_.value]])]),_:1})]),_:1},512),r("div",ue,[o(s,null,{default:l(({Component:a})=>[(d(),g(R,null,[u.value?b("",!0):(d(),g(J,{key:0,columns:k.value,rows:B.value,"actions-active":"",onExecuteActionlist:Y},null,8,["columns","rows"]))],1024))]),_:1})])]),r("div",de,[f.disabledEdit?b("",!0):(d(),$("button",{key:0,onClick:X,class:"btn agregar__archivo-articulo-norma"},[H("Agregar norma "),me])),o(T,{ref_key:"modalFormNorma",ref:A,title:"Subir documento",onClose:U,onSubmit:Q},{default:l(()=>[o(O,null,{default:l(()=>[o(p,{title:"Archivo"},{default:l(()=>[o(L,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a)},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{title:"Autor"},{default:l(()=>[x(r("input",{class:"search__content--text","onUpdate:modelValue":e[4]||(e[4]=a=>m.value=a),placeholder:"Ingresar autor",type:"text"},null,512),[[N,m.value]])]),_:1}),o(p,{title:"Contenido"},{default:l(()=>[x(r("textarea",{class:"search__content--text","onUpdate:modelValue":e[5]||(e[5]=a=>_.value=a),placeholder:"Ingresar resumen del contenido",type:"text",maxlength:"100"},`\r
							`,512),[[N,_.value]])]),_:1})]),_:1},512),r("div",_e,[o(s,null,{default:l(({Component:a})=>[(d(),g(R,null,[u.value?b("",!0):(d(),g(J,{key:0,columns:k.value,rows:E.value,"actions-active":"",onExecuteActionlist:Z},null,8,["columns","rows"]))],1024))]),_:1})])])]),_:1})}}};export{be as default};
