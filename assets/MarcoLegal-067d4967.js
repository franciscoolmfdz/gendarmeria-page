import{u as se,g as o,r as re,h as ue,i as ce,o as _,f as V,j as n,_ as de,m as l,n as ie,b as r,c as J,I as K,a as S,w as d,v as i,K as O}from"./index-1546c7aa.js";import{s as me,f as m,D as Q,_ as j,a as u,b as z}from"./files-660a92f1.js";import{_ as pe}from"./CHeaderBar-6f0c96f5.js";import{_ as G}from"./CFileManagement-548627bb.js";import{_ as P}from"./CTable-caa9d5d7.js";const ve={class:"section-table-articulo"},fe=r("i",{class:"large material-icons"},"arrow_upward",-1),_e={class:"content-document__section"},ge={class:"section-table-norma"},ye=r("i",{class:"large material-icons"},"arrow_upward",-1),we={class:"content-document__section"},W=8,X=9,Ve={__name:"MarcoLegal",setup(xe){const U=se(),Y=o("Marco legal"),B=U.user.id,E=o(),M=o(),p=o(!1),g=o(null),y=o(null),w=o(null),A=o(null),v=o(null),x=o(null),I=o(null),b=o(null),h=o(null),f=o(null),N=re({disabledEdit:!1}),$=o([{rowReference:"createdBy",description:"Autor"},{rowReference:"name",description:"Nombre de archivo"},{rowReference:"fecha",description:"Fecha"},{rowReference:"resumen",description:"ContenidoÂ "}]),L=me(),R=o(L.documentData),q=o(L.documentDataNorma),T=()=>N.disabledEdit?[{name:"descargar",iconName:"pageview"}]:[{name:"descargar",iconName:"pageview"},{name:"borrar",iconName:"delete_forever"}],Z=()=>{U.user.restrictions.filter(e=>e.id===1).length>0?N.disabledEdit=!1:N.disabledEdit=!0},H=()=>{},ee=async()=>{const a=new FormData;a.append("archivo",g.value);let e=v!=null&&v.value?v.value.replaceAll(/[^\w ]/g,"_"):"";e=e.replaceAll(" ","_"),a.append("nombre",e),a.append("categoryId",W),a.append("usrId",B),a.append("extendedData",JSON.stringify({createdBy:w.value,resumen:b.value,fecha:A.value}));const s={ignoreHeader:!0};await m.postFiles(a,s),g.value=null,v.value=null,w.value=null,b.value=null,A.value=null,await k()},ae=async()=>{const a=new FormData;a.append("archivo",y.value);let e=f!=null&&f.value?f.value.replaceAll(/[^\w ]/g,""):"";e=e.replaceAll(" ","_"),a.append("nombre",e),a.append("categoryId",X),a.append("usrId",B),a.append("extendedData",JSON.stringify({createdBy:x.value,resumen:h.value,fecha:I.value}));const s={ignoreHeader:!0};await m.postFiles(a,s),y.value=null,f.value=null,x.value=null,h.value=null,I.value=null,fileNormaSection.value.clearFields(),await C()},te=()=>{E.value.open()},le=()=>{M.value.open()},oe=async a=>{const e={id:a.request.id};if(a.actionName==="descargar"){const s={id:a.request.id},t={download:!0},c=await m.getFiles(s,t);window.open(c,"_blank"),await mountData()}else a.actionName==="borrar"&&(await m.deleteFiles(e),await k())},ne=async a=>{const e={id:a.request.id};if(a.actionName==="descargar"){const s={id:a.request.id},t={download:!0},c=await m.getFiles(s,t);window.open(c,"_blank"),await C()}else a.actionName==="borrar"&&(await m.deleteFiles(e),await C())},C=async()=>{p.value=!0,y.value=null,x.value=null,h.value=null;let a=await m.getFiles({categoryId:X});a=a.map(e=>{var t,c,D,F;const s=(t=e==null?void 0:e.extendedData)!=null&&t.fecha?Q.fromSQL(((c=e==null?void 0:e.extendedData)==null?void 0:c.fecha)+"-01 00:00:00").toFormat("MM-yyyy"):"";return e.fecha=s,e.createdBy=(D=e.extendedData)==null?void 0:D.createdBy,e.resumen=(F=e.extendedData)==null?void 0:F.resumen,e.actions=T(),e}),q.value=a,p.value=!1},k=async()=>{p.value=!0,g.value=null,w.value=null,b.value=null;let a=await m.getFiles({categoryId:W});a=a.map(e=>{var t,c,D,F;const s=(t=e==null?void 0:e.extendedData)!=null&&t.fecha?Q.fromSQL(((c=e==null?void 0:e.extendedData)==null?void 0:c.fecha)+"-01 00:00:00").toFormat("MM-yyyy"):"";return e.fecha=s,e.createdBy=(D=e.extendedData)==null?void 0:D.createdBy,e.resumen=(F=e.extendedData)==null?void 0:F.resumen,e.actions=T(),e}),R.value=a,p.value=!1};return ue(async()=>{Z(),await k(),await C()}),(a,e)=>{const s=ce("router-view");return _(),V(de,{class:"table-marco-legal"},{default:n(()=>[l(pe,{title:Y.value},null,8,["title"]),l(ie,{"active-spin":p.value},null,8,["active-spin"]),r("div",ve,[N.disabledEdit?S("",!0):(_(),J("button",{key:0,onClick:te,class:"btn agregar__archivo-articulo"},[K("Agregar articulo "),fe])),l(z,{ref_key:"modalForm",ref:E,title:"Subir documento",onClose:H,onSubmit:ee},{default:n(()=>[l(j,null,{default:n(()=>[l(u,{title:"Archivo"},{default:n(()=>[l(G,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{title:"Nombre archivo"},{default:n(()=>[d(r("input",{class:"search__content--text","onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),placeholder:"Ingresar nombre archivo",type:"text"},null,512),[[i,v.value]])]),_:1}),l(u,{title:"Autor"},{default:n(()=>[d(r("input",{class:"search__content--text","onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),placeholder:"Ingresar autor",type:"text"},null,512),[[i,w.value]])]),_:1}),l(u,{title:"Fecha",class:"c-periodo"},{default:n(()=>[d(r("input",{class:"periodo-item",type:"month","onUpdate:modelValue":e[3]||(e[3]=t=>A.value=t)},null,512),[[i,A.value]])]),_:1}),l(u,{title:"Contenido"},{default:n(()=>[d(r("textarea",{class:"search__content--text","onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),placeholder:"Ingresar resumen del contenido",type:"text",maxlength:"400"},`\r
					`,512),[[i,b.value]])]),_:1})]),_:1},512),r("div",_e,[l(s,null,{default:n(({Component:t})=>[(_(),V(O,null,[p.value?S("",!0):(_(),V(P,{key:0,columns:$.value,rows:R.value,"actions-active":"",onExecuteActionlist:oe},null,8,["columns","rows"]))],1024))]),_:1})])]),r("div",ge,[N.disabledEdit?S("",!0):(_(),J("button",{key:0,onClick:le,class:"btn agregar__archivo-articulo-norma"},[K("Agregar norma "),ye])),l(z,{ref_key:"modalFormNorma",ref:M,title:"Subir documento",onClose:H,onSubmit:ae},{default:n(()=>[l(j,null,{default:n(()=>[l(u,{title:"Archivo"},{default:n(()=>[l(G,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{title:"Nombre archivo"},{default:n(()=>[d(r("input",{class:"search__content--text","onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t),placeholder:"Ingresar nombre archivo",type:"text"},null,512),[[i,f.value]])]),_:1}),l(u,{title:"Autor"},{default:n(()=>[d(r("input",{class:"search__content--text","onUpdate:modelValue":e[7]||(e[7]=t=>x.value=t),placeholder:"Ingresar autor",type:"text"},null,512),[[i,x.value]])]),_:1}),l(u,{title:"Fecha",class:"c-periodo"},{default:n(()=>[d(r("input",{class:"periodo-item",type:"month","onUpdate:modelValue":e[8]||(e[8]=t=>I.value=t)},null,512),[[i,I.value]])]),_:1}),l(u,{title:"Contenido"},{default:n(()=>[d(r("textarea",{class:"search__content--text","onUpdate:modelValue":e[9]||(e[9]=t=>h.value=t),placeholder:"Ingresar resumen del contenido",type:"text",maxlength:"400"},`\r
							`,512),[[i,h.value]])]),_:1})]),_:1},512),r("div",we,[l(s,null,{default:n(({Component:t})=>[(_(),V(O,null,[p.value?S("",!0):(_(),V(P,{key:0,columns:$.value,rows:q.value,"actions-active":"",onExecuteActionlist:ne},null,8,["columns","rows"]))],1024))]),_:1})])])]),_:1})}}};export{Ve as default};
