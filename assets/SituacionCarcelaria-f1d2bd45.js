import{_ as Q}from"./CButton-c29d1a69.js";import{g as i,u as U,h as W,i as X,o as v,f as M,j as n,_ as Y,m as s,c as T,a as m,n as Z,b as l,l as I,q as tt}from"./index-ec431411.js";import{_ as f,a as $}from"./CChartDonutSection-f8d9fc93.js";import{_ as et}from"./CHeaderBar-cdabaa72.js";import{g as ot}from"./dimensionAggression-90af57f9.js";const at={key:0,class:"c-option-volver"},nt={key:1,class:"principal-section section-internos"},st={class:"principal-section"},lt={key:0,class:"principal-section__top top-position-one"},it=l("span",{class:"sub-menu__option--title"}," Ver más ",-1),ct=l("span",{class:"sub-menu__option--title"}," Ver más ",-1),ut=l("span",{class:"sub-menu__option--title"}," Ver más ",-1),rt={key:1,class:"principal-section__top top-position-two"},dt=l("span",{class:"sub-menu__option--title"}," Ver más ",-1),pt=l("span",{class:"sub-menu__option--title"}," Ver más ",-1),_t=l("span",{class:"sub-menu__option--title"}," Ver más ",-1),vt={class:"principal-section__bottom"},mt=l("span",{class:"sub-menu__option--title"},"Tasa de ocupación",-1),ft=l("span",{class:"sub-menu__option--text"},null,-1),bt=l("span",{class:"sub-menu__option--title"},"Partes denuncia ley 20.000",-1),gt=l("span",{class:"sub-menu__option--text"},null,-1),ht=l("span",{class:"sub-menu__option--title"},"Dotación vs población",-1),yt=l("span",{class:"sub-menu__option--text"},null,-1),xt=l("span",{class:"sub-menu__option--title"},"Registro de eventos violentos",-1),wt=l("span",{class:"sub-menu__option--text"},null,-1),Dt=l("span",{class:"sub-menu__option--title"},"Personal de reinserción",-1),Tt=l("span",{class:"sub-menu__option--text"},null,-1),It=l("span",{class:"sub-menu__option--title"},"Porcentaje de licencias",-1),Pt=l("span",{class:"sub-menu__option--text"},null,-1),Mt=3,$t={__name:"SituacionCarcelaria",setup(Vt){const F=i("Estado de la situación carcelaria"),r=i(!1),V=U(),R=i([{}]);i(0);const p=i(1),c=i(null),u=i(null),y=i(null),b=i(null),j=i(null),C=i(null),g=i(null),P=i(null),H=i(null),h=i(null),A=()=>{p.value=1},k=async e=>{r.value=!0,p.value=e,r.value=!1},x=async e=>{let o={categoryId:3,historySubCategoryId:e,lastPeriod:!0};return o={categoryId:3,historyId:(await I(o)).id},o},B=e=>{h.value=0;for(let o=0;o<e.length;o++){let a=e[o];h.value+=a.quantity}h.value=L(h.value)},L=e=>e.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),"."),S=async()=>{try{const e={regionId:c.value,carcelId:u.value};r.value=!0;const o=await ot(e);r.value=!1,B(o)}catch(e){console.log(e)}},E=async()=>{const e=await x(28);e.embedProfesionals=!0,c.value&&(e.regionId=c.value),u.value&&(e.carcelId=u.value),(await I(e)).items.map(a=>{H.value+=a.profesionalHombre+a.profesionalMujer})},N=async()=>{try{const e=await x(29);c.value&&(e.regionId=c.value),u.value&&(e.carcelId=u.value);const o=await tt(e);let a=0;j.value=o.map(t=>{t.tieneLicencia=t.licenseActiveTotal,t.noLicenciaVigente=t.licenseDisabledTotal,t.licenseTotal=t.licenseActiveTotal+t.licenseDisabledTotal;const _=t.tieneLicencia/t.licenseTotal*100;return a+=_,t}),C.value=(a/o.length).toFixed(1)+"%"}catch(e){console.log(e)}},q=e=>e?Math.round(e*100)/100:0,J=async()=>{var e;try{const o=await x(30);o.embedPopulation=!0,b.value=0,c.value&&(o.regionId=c.value),u.value&&(o.carcelId=u.value);let a=await I(o);(e=a==null?void 0:a.items)!=null&&e.length?(y.value=a.items.map(t=>{const _=t.imputadoHombre+t.condenadoHombre+t.procesadoHombre+t.detenidoHombre,d=t.imputadoMujer+t.condenadoMujer+t.procesadoMujer+t.detenidoMujer,w=_+d,D=t.pplMaxMujer+t.pplMaxHombre,K=w&&D?q(w*100/D):0;return b.value+=K,t}),b.value=(b.value/y.value.length).toFixed(1)):y.value=[]}catch(o){console.log(o)}},z=async()=>{var e;try{const o=await x(32);o.embedLawParts=!0,g.value=0,c.value&&(o.regionId=c.value),u.value&&(o.carcelId=u.value);let a=await I(o);(e=a==null?void 0:a.items)!=null&&e.length&&(a.items.map(t=>{t.total=t.dataEnero+t.dataFebrero+t.dataMarzo+t.dataAbril+t.dataMayo+t.dataJunio+t.dataJulio+t.dataAgosto+t.dataSeptiembre+t.dataOctubre+t.dataNoviembre+t.dataDiciembre,g.value+=t.total}),g.value=L(g.value))}catch(o){console.log(o)}},O=()=>{P.value=0;let e=0,o=0;y.value.map(t=>{let _=0;if(j.value.filter(d=>d.carcelId===t.carcelId).map(d=>_+=d.licenseActiveTotal+d.licenseDisabledTotal),_){const d=t.imputadoHombre+t.condenadoHombre+t.procesadoHombre+t.detenidoHombre,w=t.imputadoMujer+t.condenadoMujer+t.procesadoMujer+t.detenidoMujer,D=d+w;o++,e+=Math.round(_/D*100)}});let a=e/o;P.value=`${parseFloat((a/100*5).toFixed(1))} / 5`.replace(".",",")},G=async(e=2,o=8)=>{try{r.value=!0,await S(),await E(),await N(),await J(),await z(),O()}catch(a){console.log(a)}};return W(async()=>{r.value=!0;const e=V.user.restrictions.find(a=>a.typeId===2),o=V.user.restrictions.find(a=>a.typeId===3);e?c.value=parseInt(e.restriction):o?u.value=parseInt(o.restriction):(u.value=null,c.value=null),await G(),r.value=!1}),(e,o)=>{const a=X("RouterLink");return v(),M(Y,{class:"panel-situacion-carcel"},{default:n(()=>[s(et,{title:F.value,"section-value":Mt},null,8,["title"]),!r.value&&p.value===9?(v(),T("div",at,[s(Q,{class:"btn-volver",title:"Volver",onExecuteAction:A,disabled:e.blockButton},null,8,["disabled"])])):m("",!0),s(Z,{"active-spin":r.value},null,8,["active-spin"]),!r.value&&R.value.length>0?(v(),T("div",nt,[l("div",st,[p.value==1?(v(),T("div",lt,[s(f,{class:"section-donut donut-text registro-eventos",title:"Registro de eventos violentos",subtitle:"","donut-disabled":!0,pointTextfield:h.value},{default:n(()=>[s(a,{to:"registroViolencia",class:"sub-menu--option white btn-small"},{default:n(()=>[it]),_:1})]),_:1},8,["pointTextfield"]),s(f,{class:"section-donut donut-text dotacion-personal",title:"Personal de reinserción",subtitle:"","donut-disabled":!0,pointTextfield:H.value},{default:n(()=>[s(a,{to:"dotacionProfesional",class:"sub-menu--option white btn-small"},{default:n(()=>[ct]),_:1})]),_:1},8,["pointTextfield"]),s(f,{class:"section-donut section-licencias",title:"Porcentaje de licencias",subtitle:"",type:2,"point-value":C.value},{default:n(()=>[s(a,{to:"dotacionLicencia",class:"sub-menu--option white btn-small"},{default:n(()=>[ut]),_:1})]),_:1},8,["point-value"])])):m("",!0),p.value==2?(v(),T("div",rt,[s(f,{class:"section-donut section-ocupacion",title:"Tasa de ocupación",subtitle:"","is-percent":!0,type:2,"point-value":b.value},{default:n(()=>[s(a,{to:"poblacionImputados",class:"sub-menu--option white btn-small"},{default:n(()=>[dt]),_:1})]),_:1},8,["point-value"]),s(f,{class:"section-donut donut-text section-partes",title:"Partes denuncia ley 20.000",subtitle:"","donut-disabled":!0,pointTextfield:g.value},{default:n(()=>[s(a,{to:"partesDenuncia",class:"sub-menu--option white btn-small"},{default:n(()=>[pt]),_:1})]),_:1},8,["pointTextfield"]),s(f,{class:"section-donut donut-text section-dotacion",title:"Dotación vs población","donut-disabled":!0,pointTextfield:P.value},{default:n(()=>[s(a,{to:"dotacionPoblacion",class:"sub-menu--option white btn-small"},{default:n(()=>[_t]),_:1})]),_:1},8,["pointTextfield"])])):m("",!0)]),l("div",vt,[p.value!==2?(v(),M($,{key:0,class:"card-information",onClick:o[0]||(o[0]=t=>k(2))},{default:n(()=>[s(a,{to:"#",class:"sub-menu--option options-bottom"},{default:n(()=>[mt,ft]),_:1}),s(a,{to:"#",class:"sub-menu--option options-bottom"},{default:n(()=>[bt,gt]),_:1}),s(a,{to:"#",class:"sub-menu--option options-bottom"},{default:n(()=>[ht,yt]),_:1})]),_:1})):m("",!0),p.value!==1?(v(),M($,{key:1,class:"card-information",onClick:o[1]||(o[1]=t=>k(1))},{default:n(()=>[s(a,{to:"#",class:"sub-menu--option options-bottom"},{default:n(()=>[xt,wt]),_:1}),s(a,{to:"#",class:"sub-menu--option options-bottom"},{default:n(()=>[Dt,Tt]),_:1}),s(a,{to:"#",class:"sub-menu--option options-bottom"},{default:n(()=>[It,Pt]),_:1})]),_:1})):m("",!0)])])):m("",!0)]),_:1})}}};export{$t as default};
