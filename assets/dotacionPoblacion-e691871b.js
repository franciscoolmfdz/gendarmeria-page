import{g as i,h as J,o as L,f as K,j as O,_ as Q,l as M,q as W,b as g,m as r,n as X,x as Y,c as Z,a as ee,e as te,C as ae}from"./index-106b661f.js";import{_ as oe}from"./subSideNav-74b06d6b.js";import{_ as se}from"./CHeaderBar-ccd49ff3.js";import{_ as $}from"./CButton-2aa861ab.js";import{_ as ie}from"./CTable-591f28f0.js";import{s as ne}from"./filterSituacion-47aaad71.js";import"./CChartDonutSection-3f16d68f.js";const le={class:"content-poblacion-header"},re={class:"selected-options"},ce={key:0,class:"c-option-volver"},de={class:"table-section-principal"},ue={class:"content__section"},u=3,B=30,E=29,He={__name:"dotacionPoblacion",setup(pe){const y=i("Estado situación carcelaria / Dotación vs población"),s=ne(),k=i(null),b=i({id:15,description:"Región Metropolitana de Santiago"}),H=i([]),n=i(0),I=i(0),j=i(),C=i(),v=i(!1),A=i([{description:"Centro penitenciario",colspan:1},{description:"Dotación total",colspan:1},{description:"Total PPL. 24h",colspan:3},{description:"En % relación dotación vs total ppl",colspan:2}]),N=i([{rowReference:"establecimiento",description:""},{rowReference:"dotacionTotal",description:""},{rowReference:"totalPplHombre",description:"Hombre"},{rowReference:"totalPplMujer",description:"Mujer"},{rowReference:"totalPplTotal",description:"Total"},{rowReference:"dotacionRotacion",description:"(cantidad de internos por funcionario)"},{rowReference:"porcRotacionDotacion",description:"En % relación dotación vs total ppl"}]),h=i([]),c=e=>e<85?"class-verde":e>85&&e<99?"class-ambar":"class-rojo",F=()=>{te.push("/situacionCarcelaria")},d=e=>e?`${Math.round(e*100)/100} %`:"0 %",q=(e,t)=>{const a=s.listadoCarceles.find(o=>o.id===e.carcelId);if(a&&(a!=null&&a.id)){let o=0;t.filter(_=>_.carcelId===a.id).map(_=>o+=_.licenseActiveTotal+_.licenseDisabledTotal);const l=e.imputadoHombre+e.condenadoHombre+e.procesadoHombre+e.detenidoHombre,f=e.imputadoMujer+e.condenadoMujer+e.procesadoMujer+e.detenidoMujer,p=l+f,R=e.imputadoHombre+e.imputadoMujer,m=e.pplMaxMujer+e.pplMaxHombre,x=l&&e.pplMaxHombre?d(l*100/e.pplMaxHombre):0,P=f&&e.pplMaxMujer?d(f*100/e.pplMaxMujer):0,T=p&&m?d(p*100/m):0,D=e.imputadoHombre&&e.pplMaxHombre?d(e.imputadoHombre*100/e.pplMaxHombre):0,S=e.imputadoMujer&&e.pplMaxMujer?d(e.imputadoMujer*100/e.pplMaxMujer):0,V=R&&m?d(R*100/m):0;return{dotacionTotal:o,carcelId:a.id,establecimiento:a.description,imputadoHombre:e.imputadoHombre,imputadoMujer:e.imputadoMujer,imputadoTotal:e.imputadoHombre+e.imputadoMujer,totalPplHombre:l,totalPplMujer:f,totalPplTotal:p,capacidadHombre:e.pplMaxHombre,capacidadMujer:e.pplMaxMujer,capacidadTotal:m,usoCapacidadHombre:{data:x+"%",class:c(x)},usoCapacidadMujer:{data:P+"%",class:c(P)},usoCapacidadTotal:{data:T+"%",class:c(T)},usoImputadoHombre:{data:D+"%",class:c(D)},usoImputadoMujer:{data:S+"%",class:c(S)},usoImputadoTotal:{data:V+"%",class:c(V)},dotacionRotacion:Math.round(p/o),porcRotacionDotacion:Math.round(o/p*100)}}},U=async()=>{var a,o,l;let e={categoryId:u,historySubCategoryId:B,lastPeriod:!0};j.value||(j.value=await M(e));let t={categoryId:u,historySubCategoryId:E,lastPeriod:!0};return C.value||(C.value=await M(t)),e={categoryId:u,historySubCategoryId:B,historyId:j.value.id,embedPopulation:!0},t={categoryId:u,historySubCategoryId:E,historyId:C.value.id,embedLicenses:!0},n.value?(e.regionId=(a=n.value)!=null&&a.id?n.value.id:n.value,t.regionId=(o=n.value)!=null&&o.id?n.value.id:n.value):(l=s==null?void 0:s.regionSelected)!=null&&l.id&&(e.regionId=s.regionSelected.id,t.regionId=s.regionSelected.id),I.value&&(e.carcelId=I.value,t.carcelId=I.value),await z(),{filtersPoblacion:e,filtersLicencias:t}},z=async()=>{if(!s.listadoCarceles.length){let e=await ae();s.setCarcelesList(e)}},w=async()=>{try{if(n){const e=await U();let t=await M(e.filtersPoblacion),a=await M(e.filtersLicencias);h.value=t.items.map(o=>q(o,(a==null?void 0:a.items)??[])).filter(o=>o)}}catch(e){console.log(e)}},G=async e=>{if(!s.listadoRegiones.length>0){let t=await W();H.value=t,s.setRegionesList(t)}else H.value=s.listadoRegiones};return J(async()=>{v.value=!0,b.value=s.regionSelected,await G(),await w(),v.value=!1}),(e,t)=>(L(),K(Q,{class:"contenido-dotacion-poblacion"},{default:O(()=>[g("div",le,[r(se,{title:y.value,"section-value":u},null,8,["title"]),r(X,{"active-spin":v.value},null,8,["active-spin"]),g("div",re,[r(Y,{class:"select-region",options:H.value,modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a)},null,8,["options","modelValue"]),r($,{class:"btn-search",title:"",onExecuteAction:w})]),!v.value&&e.topPosition!==0?(L(),Z("div",ce,[r($,{class:"btn-volver",title:"Volver",onExecuteAction:F,disabled:e.blockButton},null,8,["disabled"])])):ee("",!0)]),g("div",de,[r(oe,{class:"subsection-poblacion",title:y.value,"section-value":u,pointValue:k.value,pointTitle:"Dotación vs población",pointSubtitle:""},null,8,["title","pointValue"]),g("div",ue,[r(ie,{"parent-columns":A.value,columns:N.value,rows:h.value},null,8,["parent-columns","columns","rows"])])])]),_:1}))}};export{He as default};
