import{g as s,h as J,o as L,f as K,j as O,_ as Q,l as M,q as W,m as c,b as w,x as X,c as Y,a as Z,e as ee,C as te}from"./index-caf32ba9.js";import{_ as ae}from"./subSideNav-a58b3954.js";import{_ as oe}from"./CHeaderBar-d352756e.js";import{_ as $}from"./CButton-98714c16.js";import{_ as se}from"./CTable-0b9142cc.js";import{s as ie}from"./filterSituacion-e46a409d.js";import"./CChartDonutSection-6897dea7.js";const ne={class:"selected-options"},re={key:0,class:"c-option-volver"},ce={class:"table-section-principal"},le={class:"content__section"},l=3,B=30,E=29,_e={__name:"dotacionPoblacion",setup(de){const C=s("Estado situación carcelaria / Dotación vs población"),o=ie(),k=s(null),g=s({id:15,description:"Región Metropolitana de Santiago"}),_=s([]),p=s(0),j=s(0),H=s(),I=s(),b=s(!1),A=s([{description:"Centro penitenciario",colspan:1},{description:"Dotación total",colspan:1},{description:"Total PPL. 24h",colspan:3},{description:"Capacidad según diseño (Incluye 24 hrs y juveniles)",colspan:3},{description:"En % relación dotación vs total ppl",colspan:2}]),F=s([{rowReference:"establecimiento",description:""},{rowReference:"dotacionTotal",description:""},{rowReference:"totalPplHombre",description:"Hombre"},{rowReference:"totalPplMujer",description:"Mujer"},{rowReference:"totalPplTotal",description:"Total"},{rowReference:"capacidadHombre",description:"Hombre"},{rowReference:"capacidadMujer",description:"Mujer"},{rowReference:"capacidadTotal",description:"Total"},{rowReference:"dotacionRotacion",description:"(cantidad de internos por funcionario)"},{rowReference:"porcRotacionDotacion",description:"En % relación dotación vs total ppl"}]),R=s([]),n=e=>e<85?"class-verde":e>85&&e<99?"class-ambar":"class-rojo",N=()=>{ee.push("/situacionCarcelaria")},r=e=>e?`${Math.round(e*100)/100} %`:"0 %",q=(e,t)=>{const a=o.listadoCarceles.find(i=>i.id===e.carcelId);if(a&&(a!=null&&a.id)){let i=0;t.filter(v=>v.carcelId===a.id).map(v=>i+=v.licenseActiveTotal+v.licenseDisabledTotal);const m=e.imputadoHombre+e.condenadoHombre+e.procesadoHombre+e.detenidoHombre,f=e.imputadoMujer+e.condenadoMujer+e.procesadoMujer+e.detenidoMujer,d=m+f,T=e.imputadoHombre+e.imputadoMujer,u=e.pplMaxMujer+e.pplMaxHombre,x=m&&e.pplMaxHombre?r(m*100/e.pplMaxHombre):0,P=f&&e.pplMaxMujer?r(f*100/e.pplMaxMujer):0,h=d&&u?r(d*100/u):0,D=e.imputadoHombre&&e.pplMaxHombre?r(e.imputadoHombre*100/e.pplMaxHombre):0,V=e.imputadoMujer&&e.pplMaxMujer?r(e.imputadoMujer*100/e.pplMaxMujer):0,S=T&&u?r(T*100/u):0;return{dotacionTotal:i,carcelId:a.id,establecimiento:a.description,imputadoHombre:e.imputadoHombre,imputadoMujer:e.imputadoMujer,imputadoTotal:e.imputadoHombre+e.imputadoMujer,totalPplHombre:m,totalPplMujer:f,totalPplTotal:d,capacidadHombre:e.pplMaxHombre,capacidadMujer:e.pplMaxMujer,capacidadTotal:u,usoCapacidadHombre:{data:x+"%",class:n(x)},usoCapacidadMujer:{data:P+"%",class:n(P)},usoCapacidadTotal:{data:h+"%",class:n(h)},usoImputadoHombre:{data:D+"%",class:n(D)},usoImputadoMujer:{data:V+"%",class:n(V)},usoImputadoTotal:{data:S+"%",class:n(S)},dotacionRotacion:Math.round(d/i),porcRotacionDotacion:Math.round(i/d*100)}}},U=async()=>{var a;let e={categoryId:l,subCategoryId:B,lastPeriod:!0};H.value||(H.value=await M(e));let t={categoryId:l,subCategoryId:E,lastPeriod:!0};return I.value||(I.value=await M(t)),e={categoryId:l,subCategoryId:B,historyId:H.value.id,embedPopulation:!0},t={categoryId:l,subCategoryId:E,historyId:I.value.id,embedLicenses:!0},p.value?(e.regionId=p.value,t.regionId=p.value):(a=o==null?void 0:o.regionSelected)!=null&&a.id&&(e.regionId=o.regionSelected.id,t.regionId=o.regionSelected.id),j.value&&(e.carcelId=j.value,t.carcelId=j.value),await z(),{filtersPoblacion:e,filtersLicencias:t}},z=async()=>{if(!o.listadoCarceles.length){const e={regionId:o.regionSelected.id};let t=await te(e);o.setCarcelesList(t)}},y=async()=>{try{if(p){const e=await U();let t=await M(e.filtersPoblacion),a=await M(e.filtersLicencias);R.value=t.items.map(i=>q(i,(a==null?void 0:a.items)??[])).filter(i=>i)}}catch(e){console.log(e)}},G=async e=>{if(!o.listadoRegiones.length>0){let t=await W();_.value=t,o.setRegionesList(t)}else _.value=o.listadoRegiones};return J(async()=>{b.value=!0,g.value=o.regionSelected,await G(),await y(),b.value=!1}),(e,t)=>(L(),K(Q,{class:"contenido-dotacion-poblacion"},{default:O(()=>[c(oe,{title:C.value,"section-value":l},null,8,["title"]),w("div",ne,[c(X,{class:"select-region",options:_.value,modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a)},null,8,["options","modelValue"]),c($,{class:"btn-search",title:"",onExecuteAction:y})]),!b.value&&e.topPosition!==0?(L(),Y("div",re,[c($,{class:"btn-volver",title:"Volver",onExecuteAction:N,disabled:e.blockButton},null,8,["disabled"])])):Z("",!0),w("div",ce,[c(ae,{class:"subsection-poblacion",title:C.value,"section-value":l,pointValue:k.value,pointTitle:"Apego institucional",pointSubtitle:"Frecuencia de respuestas apego institucional"},null,8,["title","pointValue"]),w("div",le,[c(se,{"parent-columns":A.value,columns:F.value,rows:R.value},null,8,["parent-columns","columns","rows"])])])]),_:1}))}};export{_e as default};
