import{g as i,h as J,o as $,f as K,j as O,_ as Q,l as g,q as W,b,m as r,n as X,x as Y,c as Z,a as ee,e as te,C as ae}from"./index-25c43d8d.js";import{_ as oe}from"./subSideNav-b136dd6f.js";import{_ as se}from"./CHeaderBar-08539ac4.js";import{_ as L}from"./CButton-06d5ac95.js";import{_ as ie}from"./CTable-3b2e2855.js";import{s as le}from"./filterSituacion-18ef9893.js";import"./CChartDonutSection-a151dd12.js";const ne={class:"content-poblacion-header"},re={class:"selected-options"},ce={key:0,class:"c-option-volver"},de={class:"table-section-principal"},ue={class:"content__section"},u=3,B=30,E=29,je={__name:"dotacionPoblacion",setup(pe){const y=i("Estado situación carcelaria / Dotación vs población"),s=le(),h=i(null),l=i({id:15,description:"Región Metropolitana de Santiago"}),j=i([]);i(0);const H=i(0),C=i(),I=i(),v=i(!1),k=i([{description:"Centro penitenciario",colspan:1},{description:"Dotación total",colspan:1},{description:"Total PPL. 24h",colspan:3},{description:"En % relación dotación vs total ppl",colspan:2}]),F=i([{rowReference:"establecimiento",description:""},{rowReference:"dotacionTotal",description:""},{rowReference:"totalPplHombre",description:"Hombre"},{rowReference:"totalPplMujer",description:"Mujer"},{rowReference:"totalPplTotal",description:"Total"},{rowReference:"dotacionRotacion",description:"Cantidad internos por funcionario"},{rowReference:"porcRotacionDotacion",description:"En % relación dotación vs total ppl"}]),f=i([]),c=e=>e<85?"class-verde":e>85&&e<99?"class-ambar":"class-rojo",A=()=>{te.push("/situacionCarcelaria")},d=e=>e?`${Math.round(e*100)/100} %`:"0 %",N=(e,t)=>{const a=s.listadoCarceles.find(o=>o.id===e.carcelId);if(a&&(a!=null&&a.id)){let o=0;t.filter(M=>M.carcelId===a.id).map(M=>o+=M.licenseActiveTotal+M.licenseDisabledTotal);const n=e.imputadoHombre+e.condenadoHombre+e.procesadoHombre+e.detenidoHombre,_=e.imputadoMujer+e.condenadoMujer+e.procesadoMujer+e.detenidoMujer,p=n+_,x=e.imputadoHombre+e.imputadoMujer,m=e.pplMaxMujer+e.pplMaxHombre,P=n&&e.pplMaxHombre?d(n*100/e.pplMaxHombre):0,R=_&&e.pplMaxMujer?d(_*100/e.pplMaxMujer):0,T=p&&m?d(p*100/m):0,D=e.imputadoHombre&&e.pplMaxHombre?d(e.imputadoHombre*100/e.pplMaxHombre):0,S=e.imputadoMujer&&e.pplMaxMujer?d(e.imputadoMujer*100/e.pplMaxMujer):0,V=x&&m?d(x*100/m):0;return{dotacionTotal:o,carcelId:a.id,establecimiento:a.description,imputadoHombre:e.imputadoHombre,imputadoMujer:e.imputadoMujer,imputadoTotal:e.imputadoHombre+e.imputadoMujer,totalPplHombre:n,totalPplMujer:_,totalPplTotal:p,capacidadHombre:e.pplMaxHombre,capacidadMujer:e.pplMaxMujer,capacidadTotal:m,usoCapacidadHombre:{data:P+"%",class:c(P)},usoCapacidadMujer:{data:R+"%",class:c(R)},usoCapacidadTotal:{data:T+"%",class:c(T)},usoImputadoHombre:{data:D+"%",class:c(D)},usoImputadoMujer:{data:S+"%",class:c(S)},usoImputadoTotal:{data:V+"%",class:c(V)},dotacionRotacion:Math.round(p/o),porcRotacionDotacion:Math.round(o/p*100)+"%"}}},q=async()=>{var a,o,n;let e={categoryId:u,historySubCategoryId:B,lastPeriod:!0};C.value||(C.value=await g(e));let t={categoryId:u,historySubCategoryId:E,lastPeriod:!0};return I.value||(I.value=await g(t)),e={categoryId:u,historySubCategoryId:B,historyId:C.value.id,embedPopulation:!0},t={categoryId:u,historySubCategoryId:E,historyId:I.value.id,embedLicenses:!0},l.value?(e.regionId=(a=l.value)!=null&&a.id?l.value.id:l.value,t.regionId=(o=l.value)!=null&&o.id?l.value.id:l.value):(n=s==null?void 0:s.regionSelected)!=null&&n.id&&(e.regionId=s.regionSelected.id,t.regionId=s.regionSelected.id),H.value&&(e.carcelId=H.value,t.carcelId=H.value),await U(),{filtersPoblacion:e,filtersLicencias:t}},U=async()=>{if(!s.listadoCarceles.length){let e=await ae();s.setCarcelesList(e)}},z=()=>{let e=0;f.value.map(t=>e+=t.porcRotacionDotacion),e=e/f.value.length,h.value=`${parseFloat((e/100*5).toFixed(1))} / 5`},w=async()=>{try{const e=await q();if(l){let t=await g(e.filtersPoblacion),a=await g(e.filtersLicencias);f.value=t.items.map(o=>N(o,(a==null?void 0:a.items)??[])).filter(o=>o),z()}}catch(e){console.log(e)}},G=async e=>{if(!s.listadoRegiones.length>0){let t=await W();j.value=t,s.setRegionesList(t)}else j.value=s.listadoRegiones};return J(async()=>{v.value=!0,l.value=s.regionSelected,await G(),await w(),v.value=!1}),(e,t)=>($(),K(Q,{class:"contenido-dotacion-poblacion"},{default:O(()=>[b("div",ne,[r(se,{title:y.value,"section-value":u},null,8,["title"]),r(X,{"active-spin":v.value},null,8,["active-spin"]),b("div",re,[r(Y,{class:"select-region",options:j.value,modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a)},null,8,["options","modelValue"]),r(L,{class:"btn-search",title:"",onExecuteAction:w})]),!v.value&&e.topPosition!==0?($(),Z("div",ce,[r(L,{class:"btn-volver",title:"Volver",onExecuteAction:A,disabled:e.blockButton},null,8,["disabled"])])):ee("",!0)]),b("div",de,[r(oe,{class:"subsection-poblacion",title:y.value,"section-value":u,"point-label":h.value,"point-disabled":!0,pointTitle:"Dotación vs población",pointSubtitle:""},null,8,["title","point-label"]),b("div",ue,[r(ie,{"parent-columns":k.value,columns:F.value,rows:f.value},null,8,["parent-columns","columns","rows"])])])]),_:1}))}};export{je as default};
