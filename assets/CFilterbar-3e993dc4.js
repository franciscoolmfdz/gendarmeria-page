import{u as R,r as g,g as p,h as E,y as L,o as c,c as u,b as x,w as N,v as $,a as v,f as D,C as j,m as S,F as q,p as P,t as T,e as C,l as U}from"./index-ec431411.js";import{_ as y}from"./CButton-c29d1a69.js";const O={class:"c-filterbar"},X={class:"selected-options"},z={key:0,class:"selected-centros"},G={class:"select-centro-content"},H={key:1,class:"c-option-volver"},Q={__name:"CFilterbar",props:{baseFilter:{type:[Object,Number,String],required:!0},multipleDisabled:{type:Boolean,default:!0},monthDisabled:{type:Boolean,default:!1}},emits:["executeAction","executeRemove","executeMount"],setup(F,{emit:m}){const l=F,a=R(),f=g({disabledCentros:!1}),V=p("Buscar"),b=p(!1),h=p(a.penitenciaria),r=g([]),d=p(a.periodo),k=s=>{const e=r.filter(i=>i.id===s);n.value.push(e[0]),n.value.sort((i,o)=>i.id<o.id);const t=r.filter(i=>i.id!==s);r.splice(0,r.length),t.map(i=>r.push(i)),a.removeCarcelSelected(s),l.multipleDisabled||(h.value=null),m("executeRemove",s)},A=()=>l.baseFilter===1||l.baseFilter===2||l.baseFilter===4||l.baseFilter===7,B=()=>{l.baseFilter===1?C.push("/vidaInternosMain"):l.baseFilter===2?C.push("/vidaFuncionariosMain"):l.baseFilter===7?C.push("/dimensionTrayectoria"):l.baseFilter===4&&C.push("/elementosReinsercion")},I=async()=>{const s=n.value.find(i=>i.id===h.value);!l.multipleDisabled&&s&&(r.push(s),n.value=n.value.filter(i=>i.id!==s.id));const e=d.value.split("-"),t={year:e[0],month:e[1],categoryId:l.baseFilter,lastPeriod:!0};a.changeCriteria({periodo:d.value,penitenciaria:s??n[0]}),l.multipleDisabled||(n.value=a.listadoCarceles),await _(t),m("executeAction")},n=p(a.listadoCarceles),_=async s=>{b.value=!0;const e=await U(s);if(b.value=!1,e&&(e!=null&&e.period)&&(e!=null&&e.id)){const{period:t=null,id:i=null}=e;a.mountBaseHistory({period:t,id:i}),d.value=t}else a.cleanHistory()},M=()=>{const s=a.user.restrictions.find(t=>t.typeId===2),e=a.user.restrictions.find(t=>t.typeId===3);if(!s&&!e)return{};if(s)return f.disabledCentros=!1,{regionId:parseInt(s.restriction)};if(e)return f.disabledCentros=!0,{carcelIds:parseInt(e.restriction)}};return E(async()=>{var i;l.multipleDisabled||(V.value="Agregar a la bÃºsqueda");const s={lastPeriod:!0,categoryId:l.baseFilter},e=M();let t=await L(e);if(l.baseFilter===1){let o=[21,22,23,25];t=t.filter(w=>!o.includes(w.id))}a.mountListCarceles(t),await _(s),(!n.value||n.value.length===0)&&((i=a.penitenciaria)!=null&&i.id&&!l.multipleDisabled?(r.splice(0,r.length),a.carcelesSelected.map(o=>r.push(o)),n.value=t.filter(o=>o.id!==a.penitenciaria.id)):n.value=t),l.multipleDisabled?m("executeAction"):(r.splice(0,r.length),a.carcelesSelected.map(o=>r.push(o)),a.removeCarcelesSelected(),m("executeMount"))}),(s,e)=>(c(),u("div",O,[x("div",X,[F.monthDisabled?v("",!0):N((c(),u("input",{key:0,class:"periodo-item",type:"month","onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t)},null,512)),[[$,d.value]]),f.disabledCentros?v("",!0):(c(),D(j,{key:1,class:"c-select-item",options:n.value,modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t)},null,8,["options","modelValue"])),S(y,{class:"c-filterbar-search",title:"",onExecuteAction:I,disabled:b.value},null,8,["disabled"])]),F.multipleDisabled?v("",!0):(c(),u("div",z,[(c(!0),u(q,null,P(r,t=>(c(),u("div",G,[x("span",null,T(t.description),1),f.disabledCentros?v("",!0):(c(),D(y,{key:0,class:"deleted-centro",title:"X",onExecuteAction:i=>k(t.id)},null,8,["onExecuteAction"]))]))),256))])),A()?(c(),u("div",H,[S(y,{class:"btn-volver-filter",title:"Volver",onExecuteAction:B,disabled:b.value},null,8,["disabled"])])):v("",!0)]))}};export{Q as _};
