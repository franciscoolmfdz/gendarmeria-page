import{g as n,h as A,o as u,f as V,j as E,_ as j,q as N,l as F,y as M,x as H,b as f,m as c,n as q,c as C,C as U,a as m,e as z}from"./index-f62bec79.js";import{_ as G}from"./subSideNav-a149f5ab.js";import{_ as J}from"./CHeaderBar-768ede49.js";import{_ as L}from"./CButton-49b6c568.js";import{_ as K}from"./CTable-be98243d.js";import{s as O}from"./filterSituacion-5abea756.js";import"./CChartDonutSection-340f5160.js";const Q={class:"content-licencia-header"},W={key:0,class:"selected-options"},X={key:1,class:"c-option-volver"},Y={class:"table-section-principal"},Z={class:"content__section"},d=3,S=29,ce={__name:"licencias",setup(ee){const i=O(),s=n({id:15,description:"Región Metropolitana de Santiago"}),v=n(),o=n(!1),y=n(0),h=n(0),p=n(),b=n("Estado situación carcelaria / Porcentaje de licencias"),I=n([{rowReference:"carcel",description:"Establecimiento penal"},{rowReference:"tieneLicencia",description:"Licencia vigente"},{rowReference:"noLicenciaVigente",description:"Sin licencia vigente"},{rowReference:"licenseTotal",description:"Totales"}]),r=n([]),R=()=>{z.push("/situacionCarcelaria")},D=e=>e?`${Math.round(e*100)/100} %`:"0 %",w=async()=>{try{if(s.value){const e=await $(),a=await N(e);let l=0,_=0,g=0;r.value=a.map(t=>{const B=i.listadoCarceles.find(P=>P.id==t.carcelId);t.carcel=B.description,t.tieneLicencia=t.licenseActiveTotal,_+=t.licenseActiveTotal,g+=t.licenseDisabledTotal,t.noLicenciaVigente=t.licenseDisabledTotal,t.licenseTotal=t.licenseActiveTotal+t.licenseDisabledTotal;const T=t.tieneLicencia/t.licenseTotal*100;return t.porcentajeLicencia=D(T),l+=T,t}),r.value.push({carcel:"Total",tieneLicencia:_,noLicenciaVigente:g,licenseTotal:_+g}),y.value=(l/a.length).toFixed(1)}else r.value=[]}catch(e){console.log(e)}},$=async()=>{var a,l;let e={categoryId:d,historySubCategoryId:S,lastPeriod:!0};return p.value||(p.value=await F(e)),e={categoryId:d,historySubCategoryId:S,historyId:p.value.id,embedLicenses:!0},s.value?e.regionId=(a=s.value)!=null&&a.id?s.value.id:s.value:(l=i==null?void 0:i.regionSelected)!=null&&l.id&&(e.regionId=i.regionSelected.id,s.value=i.regionSelected),h.value&&(e.carcelId=h.value),await k(),e},k=async()=>{if(!i.listadoCarceles.length){const e={regionId:i.regionSelected.id};let a=await M(e);i.setCarcelesList(a)}},x=async e=>{if(!i.listadoRegiones.length>0){let a=await H();v.value=a,i.setRegionesList(a)}else v.value=i.listadoRegiones};return A(async()=>{o.value=!0,s.value=i.regionSelected,await x(),await w(),o.value=!1}),(e,a)=>(u(),V(j,{class:"contenido-licencia"},{default:E(()=>[f("div",Q,[c(J,{title:b.value,"section-value":d},null,8,["title"]),c(q,{"active-spin":o.value},null,8,["active-spin"]),o.value?m("",!0):(u(),C("div",W,[o.value?m("",!0):(u(),V(U,{key:0,class:"select-region",options:v.value,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value=l)},null,8,["options","modelValue"])),c(L,{class:"btn-search",title:"",onExecuteAction:w})])),!o.value&&e.topPosition!==0?(u(),C("div",X,[c(L,{class:"btn-volver",title:"Volver",onExecuteAction:R,disabled:e.blockButton},null,8,["disabled"])])):m("",!0)]),f("div",Y,[c(G,{class:"subsection-licencias",title:b.value,"section-value":d,"point-type":2,pointValue:y.value,"point-is-percent":!0,pointTitle:"Porcentaje de licencias",pointSubtitle:""},null,8,["title","pointValue"]),f("div",Z,[c(K,{columns:I.value,rows:r.value},null,8,["columns","rows"])])])]),_:1}))}};export{ce as default};
